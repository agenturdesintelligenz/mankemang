<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventor - Inventory Management</title>
    <meta name="description" content="PWA for venue inventory management and tech checks">
    <meta name="theme-color" content="#1e88e5">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <link rel="manifest" id="manifest">
    <style>
        :root {
            /* DeepSeek Theme Colors */
            --primary-color: #1e88e5;
            --primary-light: #64b5f6;
            --primary-dark: #1565c0;
            --secondary-color: #00acc1;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --danger-color: #f44336;
            --deepseek-blue: #1e88e5;
            --deepseek-light-blue: #e3f2fd;
            
            /* Light theme variables */
            --bg-color: #f8fafc;
            --text-color: #1e293b;
            --card-bg: #ffffff;
            --card-border: #e2e8f0;
            --sidebar-bg: #ffffff;
            --input-bg: #ffffff;
            --input-border: #cbd5e1;
            --modal-bg: #ffffff;
            --nav-bg: #ffffff;
            --hover-bg: #f1f5f9;
            --shadow-color: rgba(15, 23, 42, 0.08);
        }
        
        /* Dark theme variables */
        .dark-mode {
            --bg-color: #0f172a;
            --text-color: #f1f5f9;
            --card-bg: #1e293b;
            --card-border: #334155;
            --sidebar-bg: #1e293b;
            --input-bg: #334155;
            --input-border: #475569;
            --modal-bg: #1e293b;
            --nav-bg: #1e293b;
            --hover-bg: #334155;
            --shadow-color: rgba(0, 0, 0, 0.4);
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        /* Apply theme variables */
        .bg-white {
            background-color: var(--card-bg) !important;
        }
        
        .bg-gray-50 {
            background-color: var(--bg-color) !important;
        }
        
        .text-gray-800 {
            color: var(--text-color) !important;
        }
        
        .border {
            border-color: var(--card-border) !important;
        }
        
        /* PWA Styles */
        @media (display-mode: standalone) {
            header {
                padding-top: env(safe-area-inset-top);
            }
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-color);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Material Design inspired shadows */
        .shadow-material-1 {
            box-shadow: 0 1px 3px var(--shadow-color), 0 1px 2px var(--shadow-color);
        }
        
        .shadow-material-2 {
            box-shadow: 0 3px 6px var(--shadow-color), 0 3px 6px var(--shadow-color);
        }
        
        .shadow-material-3 {
            box-shadow: 0 10px 20px var(--shadow-color), 0 6px 6px var(--shadow-color);
        }
        
        .shadow-material-4 {
            box-shadow: 0 14px 28px var(--shadow-color), 0 10px 10px var(--shadow-color);
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        
        /* Status badges */
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-deployed {
            background-color: rgba(76, 175, 80, 0.1);
            color: #2e7d32;
        }
        
        .status-reserve {
            background-color: rgba(30, 136, 229, 0.1);
            color: #1565c0;
        }
        
        .status-broken {
            background-color: rgba(244, 67, 54, 0.1);
            color: #c62828;
        }
        
        .status-service {
            background-color: rgba(255, 152, 0, 0.1);
            color: #ef6c00;
        }
        
        /* iPhone 13 Pro specific optimizations */
        @media only screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) {
            .safe-area-top {
                padding-top: 47px;
            }
            
            .safe-area-bottom {
                padding-bottom: 34px;
            }
        }
        
        /* QR Code styling */
        #qrcode canvas {
            border: 1px solid var(--card-border);
            border-radius: 8px;
        }
        
        /* Bottom Navigation Island */
        .bottom-nav-island {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--nav-bg);
            border-radius: 24px;
            box-shadow: 0 10px 40px var(--shadow-color), 0 5px 10px var(--shadow-color);
            padding: 12px;
            z-index: 40;
            display: flex;
            gap: 8px;
            align-items: center;
            min-width: 300px;
            max-width: 400px;
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 8px;
            border-radius: 16px;
            color: #64748b;
            transition: all 0.2s ease;
            min-width: 60px;
        }
        
        .nav-item.active {
            background: rgba(30, 136, 229, 0.1);
            color: var(--primary-color);
        }
        
        .nav-item i {
            font-size: 20px;
            margin-bottom: 4px;
        }
        
        .nav-item span {
            font-size: 12px;
            font-weight: 500;
        }
        
        .nav-item:hover {
            background: rgba(30, 136, 229, 0.05);
        }
        
        /* Main content padding for bottom nav */
        main {
            padding-bottom: 100px;
        }
        
        /* Modal with sticky footer */
        .modal-container {
            display: flex;
            flex-direction: column;
            max-height: 85vh;
        }
        
        .modal-header {
            flex-shrink: 0;
        }
        
        .modal-body {
            flex: 1;
            overflow-y: auto;
        }
        
        .modal-footer {
            flex-shrink: 0;
            border-top: 1px solid var(--card-border);
            background: var(--bg-color);
            margin: -1.5rem;
            margin-top: 1.5rem;
            padding: 1.5rem;
            border-bottom-left-radius: 1rem;
            border-bottom-right-radius: 1rem;
        }
        
        /* Audit specific styles */
        .tech-check-item {
            transition: all 0.2s ease;
        }
        
        .tech-check-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-color);
        }
        
        /* Dark mode specific adjustments */
        .dark-mode .bg-gray-100 {
            background-color: #334155 !important;
        }
        
        .dark-mode .text-gray-600 {
            color: #cbd5e1 !important;
        }
        
        .dark-mode .text-gray-500 {
            color: #94a3b8 !important;
        }
        
        .dark-mode .border {
            border-color: #475569 !important;
        }
        
        /* Toggle switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        
        /* Settings page styles */
        .settings-section {
            margin-bottom: 2rem;
        }
        
        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--card-border);
        }
        
        .settings-item:last-child {
            border-bottom: none;
        }
        
        .settings-info {
            flex: 1;
        }
        
        .settings-info h4 {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .settings-info p {
            font-size: 0.875rem;
            color: var(--text-color);
            opacity: 0.7;
        }
        
        /* Account page styles */
        .account-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .account-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 2rem;
            color: white;
        }
        
        .account-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .account-stat {
            background: var(--card-bg);
            border-radius: 0.75rem;
            padding: 1rem;
            text-align: center;
            border: 1px solid var(--card-border);
        }
        
        .account-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .account-stat-label {
            font-size: 0.875rem;
            color: var(--text-color);
            opacity: 0.7;
        }
        
        /* Form elements in dark mode */
        .dark-mode input,
        .dark-mode select,
        .dark-mode textarea {
            background-color: var(--input-bg);
            color: var(--text-color);
            border-color: var(--input-border);
        }
        
        .dark-mode input::placeholder {
            color: #94a3b8;
        }
        
        /* Side menu in dark mode */
        .dark-mode #sideMenu {
            background-color: var(--sidebar-bg);
        }
        
        /* Bottom nav in dark mode */
        .dark-mode .bottom-nav-island {
            background-color: var(--nav-bg);
        }
        
        /* DeepSeek specific styles */
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        
        .text-primary {
            color: var(--primary-color);
        }
        
        .bg-primary {
            background-color: var(--primary-color);
        }
        
        .bg-primary-light {
            background-color: var(--primary-light);
        }
        
        .bg-deepseek-light {
            background-color: var(--deepseek-light-blue);
        }
        
        /* Company edit specific styles */
        .company-edit-section {
            margin-bottom: 2rem;
        }
        
        .company-edit-card {
            background: var(--card-bg);
            border-radius: 0.75rem;
            padding: 1.5rem;
            border: 1px solid var(--card-border);
            margin-bottom: 1.5rem;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen">
    <!-- PWA Install Prompt -->
    <div id="installPrompt" class="hidden fixed bottom-0 left-0 right-0 bg-white p-4 shadow-material-4 z-50">
        <div class="flex justify-between items-center">
            <div class="flex items-center">
                <i class="fas fa-box text-2xl text-primary mr-3"></i>
                <div>
                    <p class="font-medium">Install Inventor</p>
                    <p class="text-sm text-gray-600">Get quick access to your inventory</p>
                </div>
            </div>
            <div>
                <button id="installCancel" class="px-4 py-2 text-gray-600 mr-2">Not Now</button>
                <button id="installConfirm" class="px-4 py-2 bg-primary text-white rounded-lg">Install</button>
            </div>
        </div>
    </div>

    <!-- App Header -->
    <header class="bg-white shadow-material-1 sticky top-0 z-30 safe-area-top">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center">
                    <h1 id="companyHeader" class="text-xl font-bold text-gray-900">Inventor</h1>
                    <div id="darkModeIndicator" class="ml-2 hidden">
                        <i class="fas fa-moon text-gray-600"></i>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- Save Journal Button (shown when journal loaded) -->
                    <button id="saveJournalBtn" class="hidden px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg flex items-center">
                        <i class="fas fa-save mr-2"></i> Save Journal
                    </button>
                    
                    <!-- Load Journal Button (shown when no journal loaded) -->
                    <button id="loadJournalHeaderBtn" class="px-4 py-2 bg-primary text-white rounded-lg flex items-center">
                        <i class="fas fa-folder-open mr-2"></i> Load Journal
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main App Container -->
    <main class="container mx-auto px-4 py-6">
        <!-- Dash View -->
        <div id="dashView" class="fade-in">
            <!-- ... existing dash content ... -->
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl p-6 shadow-material-1">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-500 text-sm">Total Items</p>
                            <p id="totalItems" class="text-3xl font-bold mt-2">0</p>
                        </div>
                        <div class="bg-deepseek-light p-3 rounded-full">
                            <i class="fas fa-cubes text-primary text-xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-material-1">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-500 text-sm">Deployed</p>
                            <p id="deployedItems" class="text-3xl font-bold mt-2 text-green-600">0</p>
                        </div>
                        <div class="bg-green-100 p-3 rounded-full">
                            <i class="fas fa-check-circle text-green-500 text-xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-material-1">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-500 text-sm">Needs Attention</p>
                            <p id="attentionItems" class="text-3xl font-bold mt-2 text-orange-600">0</p>
                        </div>
                        <div class="bg-orange-100 p-3 rounded-full">
                            <i class="fas fa-exclamation-triangle text-orange-500 text-xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-material-1">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-gray-500 text-sm">Venues</p>
                            <p id="totalVenues" class="text-3xl font-bold mt-2">0</p>
                        </div>
                        <div class="bg-purple-100 p-3 rounded-full">
                            <i class="fas fa-building text-purple-500 text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-white rounded-xl p-6 shadow-material-1">
                    <h3 class="font-bold text-lg mb-4">Quick Actions</h3>
                    <div class="space-y-4">
                        <button id="quickAddItem" class="w-full flex items-center p-4 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors">
                            <div class="bg-primary text-white p-3 rounded-full mr-4">
                                <i class="fas fa-plus"></i>
                            </div>
                            <div class="text-left">
                                <p class="font-medium">Add New Item</p>
                                <p class="text-sm text-gray-500">Add equipment to inventory</p>
                            </div>
                        </button>
                        
                        <button id="quickAudit" class="w-full flex items-center p-4 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors">
                            <div class="bg-green-500 text-white p-3 rounded-full mr-4">
                                <i class="fas fa-clipboard-check"></i>
                            </div>
                            <div class="text-left">
                                <p class="font-medium">Start Audit</p>
                                <p class="text-sm text-gray-500">Verify equipment status</p>
                            </div>
                        </button>
                        
                        <button id="quickAddVenue" class="w-full flex items-center p-4 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors">
                            <div class="bg-purple-500 text-white p-3 rounded-full mr-4">
                                <i class="fas fa-building"></i>
                            </div>
                            <div class="text-left">
                                <p class="font-medium">Add New Venue</p>
                                <p class="text-sm text-gray-500">Add a new venue location</p>
                            </div>
                        </button>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-material-1">
                    <h3 class="font-bold text-lg mb-4">Recent Activity</h3>
                    <div id="recentActivity" class="space-y-4">
                        <div class="text-gray-500 text-center py-8">
                            <i class="fas fa-history text-3xl mb-3"></i>
                            <p>No recent activity</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Load Journal Prompt -->
            <div id="loadJournalPrompt" class="mt-8 bg-deepseek-light border border-blue-200 rounded-xl p-6 text-center">
                <i class="fas fa-folder-open text-4xl text-primary mb-4"></i>
                <h3 class="text-xl font-bold mb-2">No Journal Loaded</h3>
                <p class="text-gray-600 mb-4">Load a company journal to start managing your inventory</p>
                <button id="promptLoadJournalBtn" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg">
                    <i class="fas fa-folder-open mr-2"></i> Load Journal
                </button>
            </div>
        </div>
        
        <!-- Inventory Management View -->
        <div id="inventoryView" class="hidden fade-in">
            <!-- ... existing inventory content ... -->
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Inventory Management</h2>
                <button id="addItemBtn" class="px-4 py-2 bg-primary hover:bg-primary-dark text-white rounded-lg flex items-center">
                    <i class="fas fa-plus mr-2"></i> Add Item
                </button>
            </div>
            
            <div class="bg-white rounded-xl shadow-material-1 mb-6">
                <div class="p-4 border-b">
                    <div class="flex flex-col md:flex-row md:items-center space-y-4 md:space-y-0">
                        <div class="flex-grow">
                            <div class="relative">
                                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                <input type="text" id="searchInventory" placeholder="Search by ID, brand, model..." class="pl-10 pr-4 py-2 border rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                        </div>
                        
                        <div class="flex space-x-4">
                            <select id="filterStatus" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                                <option value="">All Status</option>
                                <option value="DEPLOYED">Deployed</option>
                                <option value="RESERVE">Reserve</option>
                                <option value="BROKEN">Broken</option>
                                <option value="SERVICE">Service</option>
                            </select>
                            
                            <select id="filterVenue" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                                <option value="">All Venues</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div id="inventoryList" class="p-4">
                    <div class="text-center py-12 text-gray-500">
                        <i class="fas fa-box-open text-4xl mb-4"></i>
                        <p class="text-lg">No inventory items found</p>
                        <p class="mt-2">Add your first item or load a Journal file</p>
                    </div>
                </div>
            </div>
            
            <div class="text-gray-500 text-sm">
                <p><i class="fas fa-info-circle mr-1"></i> Inventory items are automatically saved to your browser's local storage</p>
            </div>
        </div>
        
        <!-- Venues Management View -->
        <div id="venuesView" class="hidden fade-in">
            <!-- ... existing venues content ... -->
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Venues Management</h2>
                <button id="addVenueBtn" class="px-4 py-2 bg-primary hover:bg-primary-dark text-white rounded-lg flex items-center">
                    <i class="fas fa-plus mr-2"></i> Add Venue
                </button>
            </div>
            
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <!-- Venue cards will be dynamically inserted here -->
                <div id="venuesList" class="col-span-full">
                    <div class="text-center py-12 text-gray-500">
                        <i class="fas fa-building text-4xl mb-4"></i>
                        <p class="text-lg">No venues found</p>
                        <p class="mt-2">Add your first venue</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl p-6 shadow-material-1">
                <h3 class="font-bold text-lg mb-4">Venue Assignment Summary</h3>
                <div id="venueAssignmentChart" class="h-64 flex items-center justify-center text-gray-500">
                    <p>No data available. Add venues and assign inventory items.</p>
                </div>
            </div>
        </div>
        
        <!-- Audit Wizard View -->
        <div id="auditView" class="hidden fade-in">
            <!-- ... existing audit content ... -->
            <div class="max-w-4xl mx-auto">
                <div class="bg-white rounded-xl shadow-material-2 p-6 mb-8">
                    <h2 class="text-2xl font-bold mb-2">Audit Wizard</h2>
                    <p class="text-gray-600 mb-6">Step-by-step equipment verification for your venues</p>
                    
                    <div class="mb-8" id="auditStep1">
                        <div class="flex items-center mb-6">
                            <div class="w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center font-bold">1</div>
                            <div class="ml-4">
                                <h3 class="font-bold">Select Venue</h3>
                                <p class="text-gray-600 text-sm">Choose a venue to perform tech check on</p>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4" id="auditVenues">
                            <!-- Venue selection buttons will be added here -->
                            <div class="col-span-full text-center py-8 text-gray-500">
                                <i class="fas fa-map-marker-alt text-3xl mb-3"></i>
                                <p>No venues available for tech check</p>
                                <p class="text-sm mt-1">Add venues and assign inventory items first</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-8 hidden" id="auditStep2">
                        <div class="flex items-center mb-6">
                            <div class="w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center font-bold">2</div>
                            <div class="ml-4">
                                <h3 class="font-bold">Verify Equipment</h3>
                                <p class="text-gray-600 text-sm">Check each item at the selected venue</p>
                            </div>
                        </div>
                        
                        <div id="auditItems" class="space-y-4">
                            <!-- Tech check items will be added here -->
                            <div class="text-center py-8 text-gray-500">
                                <i class="fas fa-box text-3xl mb-3"></i>
                                <p>Loading equipment...</p>
                            </div>
                        </div>
                        
                        <div class="mt-8 flex justify-between">
                            <button id="auditBack" class="px-6 py-3 border rounded-lg hover:bg-gray-50">
                                <i class="fas fa-arrow-left mr-2"></i> Back to Venue Selection
                            </button>
                            <button id="auditComplete" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg">
                                Complete Audit
                            </button>
                        </div>
                    </div>
                    
                    <div class="hidden" id="auditCompleteStep">
                        <div class="text-center py-8">
                            <div class="w-16 h-16 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-check text-3xl text-green-500"></i>
                            </div>
                            <h3 class="text-2xl font-bold mb-2">Audit Complete!</h3>
                            <p class="text-gray-600 mb-6">The equipment status has been updated for <span id="completedVenueName" class="font-bold"></span></p>
                            <div class="flex justify-center space-x-4">
                                <button id="auditNew" class="px-6 py-3 border rounded-lg hover:bg-gray-50">
                                    Start New Audit
                                </button>
                                <button id="auditViewReport" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg">
                                    View Report
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="text-gray-500 text-sm">
                    <p><i class="fas fa-lightbulb mr-1"></i> Tech checks help ensure all equipment is accounted for and in working order before events.</p>
                </div>
            </div>
        </div>
        
        <!-- Settings View -->
        <div id="settingsView" class="hidden fade-in">
            <div class="max-w-3xl mx-auto">
                <h2 class="text-2xl font-bold mb-6">Settings</h2>
                
                <div class="bg-white rounded-xl shadow-material-1 p-6 mb-6">
                    <h3 class="font-bold text-lg mb-4">Appearance</h3>
                    
                    <div class="settings-item">
                        <div class="settings-info">
                            <h4>Dark Mode</h4>
                            <p>Switch between light and dark themes</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="darkModeToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="settings-item">
                        <div class="settings-info">
                            <h4>Use System Preference</h4>
                            <p>Automatically match your system's dark mode setting</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="systemThemeToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-material-1 p-6 mb-6">
                    <h3 class="font-bold text-lg mb-4">Data Management</h3>
                    
                    <div class="settings-item">
                        <div class="settings-info">
                            <h4>Auto-save</h4>
                            <p>Automatically save changes to local storage</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoSaveToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="settings-item">
                        <div class="settings-info">
                            <h4>Export Data</h4>
                            <p>Download all inventory data as JSON file</p>
                        </div>
                        <button id="exportDataBtn" class="px-4 py-2 bg-primary hover:bg-primary-dark text-white rounded-lg">
                            Export
                        </button>
                    </div>
                    
                    <div class="settings-item">
                        <div class="settings-info">
                            <h4>Import Data</h4>
                            <p>Load inventory data from JSON file</p>
                        </div>
                        <button id="importDataBtn" class="px-4 py-2 border rounded-lg hover:bg-gray-50">
                            Import
                        </button>
                    </div>
                    
                    <div class="settings-item">
                        <div class="settings-info">
                            <h4>Clear All Data</h4>
                            <p>Remove all inventory items, venues, and settings</p>
                        </div>
                        <button id="clearDataBtn" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg">
                            Clear
                        </button>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-material-1 p-6 mb-6">
                    <h3 class="font-bold text-lg mb-4">Notifications</h3>
                    
                    <div class="settings-item">
                        <div class="settings-info">
                            <h4>Audit Reminders</h4>
                            <p>Get reminders for pending equipment audits</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="auditRemindersToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="settings-item">
                        <div class="settings-info">
                            <h4>Low Stock Alerts</h4>
                            <p>Receive alerts when inventory is low</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="stockAlertsToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-material-1 p-6">
                    <h3 class="font-bold text-lg mb-4">About</h3>
                    
                    <div class="space-y-4">
                        <div class="flex justify-between">
                            <span class="text-gray-600">App Version</span>
                            <span class="font-medium">1.0.0</span>
                        </div>
                        
                        <div class="flex justify-between">
                            <span class="text-gray-600">PWA Version</span>
                            <span class="font-medium" id="pwaVersion">1.0</span>
                        </div>
                        
                        <div class="flex justify-between">
                            <span class="text-gray-600">Last Updated</span>
                            <span class="font-medium" id="lastUpdated">2024-01-15</span>
                        </div>
                        
                        <div class="mt-6 pt-6 border-t">
                            <button id="aboutInventorBtn" class="w-full px-4 py-3 border rounded-lg hover:bg-gray-50 text-left">
                                <div class="flex items-center">
                                    <i class="fas fa-info-circle text-primary mr-3"></i>
                                    <div>
                                        <p class="font-medium">About Inventor</p>
                                        <p class="text-sm text-gray-500">Learn more about this inventory management system</p>
                                    </div>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Account View -->
        <div id="accountView" class="hidden fade-in">
            <div class="max-w-3xl mx-auto">
                <div class="account-header">
                    <div class="account-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <h2 class="text-2xl font-bold" id="accountUserName">Inventor User</h2>
                    <p class="text-gray-600" id="accountUserRole">Inventory Manager</p>
                </div>
                
                <!-- Company Journal Management Section -->
                <div class="company-edit-section">
                    <div class="company-edit-card">
                        <h3 class="font-bold text-lg mb-4">Company Journal</h3>
                        
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-gray-600 text-sm">Current Company</p>
                                    <p id="currentCompanyName" class="font-medium text-lg">No journal loaded</p>
                                </div>
                                <button id="editCompanyNameBtn" class="px-4 py-2 bg-primary hover:bg-primary-dark text-white rounded-lg">
                                    <i class="fas fa-edit mr-2"></i> Edit Name
                                </button>
                            </div>
                            
                            <div class="pt-4 border-t">
                                <div class="flex space-x-2">
                                    <button id="exportJournalBtn" class="flex-1 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg flex items-center justify-center">
                                        <i class="fas fa-file-export mr-2"></i> Export Journal
                                    </button>
                                    <button id="loadJournalBtn" class="flex-1 px-4 py-2 border rounded-lg hover:bg-gray-50 flex items-center justify-center">
                                        <i class="fas fa-folder-open mr-2"></i> Load Journal
                                    </button>
                                </div>
                                <p class="text-xs text-gray-500 mt-2">Export your current journal or load a new one</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-material-1 p-6 mb-6">
                    <h3 class="font-bold text-lg mb-4">Profile Information</h3>
                    
                    <div class="space-y-4">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Full Name</span>
                            <span class="font-medium" id="profileName">Not Set</span>
                        </div>
                        
                        <div class="flex justify-between">
                            <span class="text-gray-600">Email</span>
                            <span class="font-medium" id="profileEmail">Not Set</span>
                        </div>
                        
                        <div class="flex justify-between">
                            <span class="text-gray-600">Role</span>
                            <span class="font-medium" id="profileRole">Inventory Manager</span>
                        </div>
                        
                        <div class="flex justify-between">
                            <span class="text-gray-600">Member Since</span>
                            <span class="font-medium" id="memberSince">2024-01-01</span>
                        </div>
                        
                        <div class="mt-4">
                            <button id="editProfileBtn" class="w-full px-4 py-2 bg-primary hover:bg-primary-dark text-white rounded-lg">
                                Edit Profile
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-material-1 p-6 mb-6">
                    <h3 class="font-bold text-lg mb-4">Storage Usage</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-gray-600">Local Storage</span>
                                <span class="font-medium" id="storageUsed">0 KB</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div id="storageBar" class="bg-primary h-2 rounded-full" style="width: 0%"></div>
                            </div>
                            <p class="text-sm text-gray-500 mt-1">Approximately <span id="storageItems">0</span> items stored locally</p>
                        </div>
                        
                        <div class="account-stats">
                            <div class="account-stat">
                                <div class="account-stat-value" id="statItems">0</div>
                                <div class="account-stat-label">Items</div>
                            </div>
                            <div class="account-stat">
                                <div class="account-stat-value" id="statVenues">0</div>
                                <div class="account-stat-label">Venues</div>
                            </div>
                            <div class="account-stat">
                                <div class="account-stat-value" id="statAudits">0</div>
                                <div class="account-stat-label">Audits</div>
                            </div>
                            <div class="account-stat">
                                <div class="account-stat-value" id="statActivity">0</div>
                                <div class="account-stat-label">Activities</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-material-1 p-6">
                    <h3 class="font-bold text-lg mb-4">Account Actions</h3>
                    
                    <div class="space-y-3">
                        <button id="changePasswordBtn" class="w-full px-4 py-3 border rounded-lg hover:bg-gray-50 text-left">
                            <div class="flex items-center">
                                <i class="fas fa-key text-gray-500 mr-3"></i>
                                <div>
                                    <p class="font-medium">Change Password</p>
                                    <p class="text-sm text-gray-500">Update your account password</p>
                                </div>
                            </div>
                        </button>
                        
                        <button id="backupDataBtn" class="w-full px-4 py-3 border rounded-lg hover:bg-gray-50 text-left">
                            <div class="flex items-center">
                                <i class="fas fa-cloud-upload-alt text-gray-500 mr-3"></i>
                                <div>
                                    <p class="font-medium">Backup Data</p>
                                    <p class="text-sm text-gray-500">Create a backup of all your data</p>
                                </div>
                            </div>
                        </button>
                        
                        <button id="exportAllDataBtn" class="w-full px-4 py-3 border rounded-lg hover:bg-gray-50 text-left">
                            <div class="flex items-center">
                                <i class="fas fa-download text-gray-500 mr-3"></i>
                                <div>
                                    <p class="font-medium">Export All Data</p>
                                    <p class="text-sm text-gray-500">Download complete data export</p>
                                </div>
                            </div>
                        </button>
                        
                        <button id="logoutBtn" class="w-full px-4 py-3 border rounded-lg hover:bg-gray-50 text-left text-red-500">
                            <div class="flex items-center">
                                <i class="fas fa-sign-out-alt mr-3"></i>
                                <div>
                                    <p class="font-medium">Log Out</p>
                                    <p class="text-sm">Sign out of your account</p>
                                </div>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bottom Navigation Island -->
        <div class="bottom-nav-island">
            <button class="nav-item active" data-tab="dash">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dash</span>
            </button>
            <button class="nav-item" data-tab="audit">
                <i class="fas fa-clipboard-check"></i>
                <span>Audit</span>
            </button>
            <button class="nav-item" data-tab="inventory">
                <i class="fas fa-cubes"></i>
                <span>Inventory</span>
            </button>
            <button class="nav-item" data-tab="venues">
                <i class="fas fa-building"></i>
                <span>Venues</span>
            </button>
            <button id="bottomMenuBtn" class="nav-item">
                <i class="fas fa-ellipsis-h"></i>
                <span>More</span>
            </button>
        </div>
        
        <!-- Side Menu -->
        <div id="sideMenu" class="fixed top-0 right-0 h-full w-64 bg-white shadow-material-4 transform translate-x-full transition-transform z-50">
            <div class="p-6 h-full flex flex-col">
                <div class="flex justify-between items-center mb-8">
                    <h3 class="font-bold text-lg">Menu</h3>
                    <button id="closeMenuBtn" class="p-2 hover:bg-gray-100 rounded-full">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-2 flex-grow">
                    <div class="px-3 py-2 bg-gray-100 rounded-lg mb-4">
                        <p class="text-gray-500 text-sm">Current Company</p>
                        <p id="menuCompanyName" class="font-medium">None loaded</p>
                    </div>
                    
                    <button class="menu-item w-full text-left p-3 rounded-lg hover:bg-gray-100" data-tab="dash">
                        <i class="fas fa-tachometer-alt mr-3 text-gray-500"></i> Dash
                    </button>
                    <button class="menu-item w-full text-left p-3 rounded-lg hover:bg-gray-100" data-tab="inventory">
                        <i class="fas fa-cubes mr-3 text-gray-500"></i> Inventory
                    </button>
                    <button class="menu-item w-full text-left p-3 rounded-lg hover:bg-gray-100" data-tab="venues">
                        <i class="fas fa-building mr-3 text-gray-500"></i> Venues
                    </button>
                    <button class="menu-item w-full text-left p-3 rounded-lg hover:bg-gray-100" data-tab="audit">
                        <i class="fas fa-clipboard-check mr-3 text-gray-500"></i> Audit
                    </button>
                    <hr class="my-4">
                    <button class="menu-item w-full text-left p-3 rounded-lg hover:bg-gray-100" data-tab="settings">
                        <i class="fas fa-cog mr-3 text-gray-500"></i> Settings
                    </button>
                    <button class="menu-item w-full text-left p-3 rounded-lg hover:bg-gray-100" data-tab="account">
                        <i class="fas fa-user mr-3 text-gray-500"></i> Account
                    </button>
                    <hr class="my-4">
                    <button id="menuExport" class="menu-item w-full text-left p-3 rounded-lg hover:bg-gray-100">
                        <i class="fas fa-file-export mr-3 text-gray-500"></i> Export Journal
                    </button>
                    <button id="menuImport" class="menu-item w-full text-left p-3 rounded-lg hover:bg-gray-100">
                        <i class="fas fa-file-import mr-3 text-gray-500"></i> Load Journal
                    </button>
                    <button id="menuClearData" class="menu-item w-full text-left p-3 rounded-lg hover:bg-gray-100 text-red-500">
                        <i class="fas fa-trash-alt mr-3"></i> Clear All Data
                    </button>
                </div>
                
                <div class="pt-6 border-t">
                    <div class="flex items-center justify-between mb-2">
                        <p class="text-gray-500 text-xs">Dark Mode</p>
                        <label class="toggle-switch small">
                            <input type="checkbox" id="menuDarkModeToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <p class="text-gray-500 text-xs">Inventor v1.0  PWA</p>
                </div>
            </div>
        </div>
        
        <!-- Modal Backdrop -->
        <div id="modalBackdrop" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40"></div>
        
        <!-- Add/Edit Item Modal -->
        <div id="itemModal" class="hidden fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl shadow-material-4 w-full max-w-md z-50">
            <div class="modal-container p-6">
                <div class="modal-header flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold" id="itemModalTitle">Add Inventory Item</h3>
                    <button id="closeItemModal" class="p-2 hover:bg-gray-100 rounded-full">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="itemForm" class="modal-body space-y-4">
                    <input type="hidden" id="itemId">
                    
                    <!-- Image at the top -->
                    <div>
                        <label class="block text-sm font-medium mb-1">Item Image</label>
                        <div class="mt-1">
                            <div class="w-full h-48 bg-gray-100 rounded-lg flex items-center justify-center mb-4 overflow-hidden" id="itemImagePreview">
                                <i class="fas fa-camera text-gray-400 text-4xl"></i>
                            </div>
                            <div class="flex items-center justify-center">
                                <input type="file" id="itemImage" accept="image/*" class="hidden">
                                <button type="button" id="itemImageBtn" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg mr-2">
                                    <i class="fas fa-upload mr-2"></i> Choose Image
                                </button>
                                <button type="button" id="itemImageRemoveBtn" class="px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg hidden">
                                    <i class="fas fa-trash mr-2"></i> Remove
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-1 text-center">Optional. Max 2MB. Image will be stored in the journal.</p>
                        </div>
                    </div>
                    
                    <!-- Unique Identifier with QR button -->
                    <div>
                        <label class="block text-sm font-medium mb-1" for="itemUniqueId">Unique Identifier *</label>
                        <div class="flex">
                            <input type="text" id="itemUniqueId" class="flex-grow px-4 py-2 border rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary" required>
                            <button type="button" id="qrCodeBtn" class="px-4 py-2 bg-gray-100 border border-l-0 rounded-r-lg hover:bg-gray-200">
                                <i class="fas fa-qrcode"></i>
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Unique identifier for this item</p>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-1" for="itemBrand">Brand</label>
                            <input type="text" id="itemBrand" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-1" for="itemModel">Model</label>
                            <input type="text" id="itemModel" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-1" for="itemCategories">Categories</label>
                        <div class="flex flex-wrap gap-2 mb-2" id="selectedCategories">
                            <!-- Selected categories will appear here -->
                        </div>
                        <div class="flex">
                            <select id="itemCategorySelect" class="flex-grow px-4 py-2 border rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary">
                                <option value="">Select a category</option>
                                <option value="Moving Head">Moving Head</option>
                                <option value="Turntable">Turntable</option>
                                <option value="Cable">Cable</option>
                                <option value="PSU">PSU</option>
                                <option value="Controller">Controller</option>
                                <option value="Lighting">Lighting</option>
                                <option value="Audio">Audio</option>
                                <option value="Video">Video</option>
                                <option value="Other">Other</option>
                            </select>
                            <button type="button" id="addCategoryBtn" class="px-4 py-2 bg-gray-100 border border-l-0 rounded-r-lg hover:bg-gray-200">Add</button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Multiple categories can be assigned</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-1" for="itemStatus">Status *</label>
                        <select id="itemStatus" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required>
                            <option value="">Select status</option>
                            <option value="DEPLOYED">Deployed</option>
                            <option value="RESERVE">Reserve</option>
                            <option value="BROKEN">Broken</option>
                            <option value="SERVICE">Service</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-1" for="itemVenue">Assigned Venue</label>
                        <select id="itemVenue" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                            <option value="">Unassigned</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-1" for="itemComment">Comment</label>
                        <textarea id="itemComment" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Notes about this item..."></textarea>
                    </div>
                </form>
                
                <div class="modal-footer">
                    <div class="flex justify-end space-x-4">
                        <button type="button" id="cancelItemBtn" class="px-6 py-2 border rounded-lg hover:bg-gray-50">Cancel</button>
                        <button type="submit" id="submitItemBtn" form="itemForm" class="px-6 py-2 bg-primary hover:bg-primary-dark text-white rounded-lg flex items-center">
                            <i class="fas fa-save mr-2"></i> Save Item
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- QR Code Modal -->
        <div id="qrCodeModal" class="hidden fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl shadow-material-4 w-full max-w-md z-50">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">QR Code Label</h3>
                    <button id="closeQrCodeModal" class="p-2 hover:bg-gray-100 rounded-full">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="text-center mb-6">
                    <div id="qrcode" class="flex justify-center mb-4"></div>
                    <p class="font-medium text-lg" id="qrItemId"></p>
                    <p class="text-gray-600 text-sm" id="qrItemDetails"></p>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg mb-6">
                    <h4 class="font-bold mb-2">Print Instructions</h4>
                    <ul class="text-sm text-gray-600 space-y-1">
                        <li>1. Use sticker paper (A4, 8-12 labels per sheet)</li>
                        <li>2. Set printer margins to minimum</li>
                        <li>3. Print at 100% scale</li>
                        <li>4. Apply labels to equipment</li>
                    </ul>
                </div>
                
                <div class="flex justify-between">
                    <button id="printQrCodeBtn" class="px-6 py-2 bg-primary hover:bg-primary-dark text-white rounded-lg flex items-center">
                        <i class="fas fa-print mr-2"></i> Print
                    </button>
                    <button id="downloadQrCodeBtn" class="px-6 py-2 border rounded-lg hover:bg-gray-50">
                        <i class="fas fa-download mr-2"></i> Download
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Add/Edit Venue Modal -->
        <div id="venueModal" class="hidden fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl shadow-material-4 w-full max-w-md z-50">
            <div class="modal-container p-6">
                <div class="modal-header flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold" id="venueModalTitle">Add Venue</h3>
                    <button id="closeVenueModal" class="p-2 hover:bg-gray-100 rounded-full">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="venueForm" class="modal-body space-y-4">
                    <input type="hidden" id="venueId">
                    
                    <div>
                        <label class="block text-sm font-medium mb-1" for="venueName">Venue Name *</label>
                        <input type="text" id="venueName" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-1" for="venueAddress">Address</label>
                        <input type="text" id="venueAddress" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-1" for="venueContact">Contact Person</label>
                            <input type="text" id="venueContact" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-1" for="venuePhone">Phone</label>
                            <input type="text" id="venuePhone" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-1" for="venueNotes">Notes</label>
                        <textarea id="venueNotes" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Additional information about this venue..."></textarea>
                    </div>
                </form>
                
                <div class="modal-footer">
                    <div class="flex justify-end space-x-4">
                        <button type="button" id="cancelVenueBtn" class="px-6 py-2 border rounded-lg hover:bg-gray-50">Cancel</button>
                        <button type="submit" id="submitVenueBtn" form="venueForm" class="px-6 py-2 bg-primary hover:bg-primary-dark text-white rounded-lg flex items-center">
                            <i class="fas fa-save mr-2"></i> Save Venue
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Audit Report Modal -->
        <div id="reportModal" class="hidden fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl shadow-material-4 w-full max-w-2xl max-h-[90vh] overflow-y-auto z-50">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">Audit Report</h3>
                    <button id="closeReportModal" class="p-2 hover:bg-gray-100 rounded-full">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div id="reportContent">
                    <!-- Report content will be generated here -->
                </div>
                
                <div class="mt-8 pt-6 border-t">
                    <div class="flex justify-end">
                        <button id="printReportBtn" class="px-6 py-2 bg-primary hover:bg-primary-dark text-white rounded-lg flex items-center">
                            <i class="fas fa-print mr-2"></i> Print Report
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Profile Edit Modal -->
        <div id="profileModal" class="hidden fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl shadow-material-4 w-full max-w-md z-50">
            <div class="modal-container p-6">
                <div class="modal-header flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">Edit Profile</h3>
                    <button id="closeProfileModal" class="p-2 hover:bg-gray-100 rounded-full">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="profileForm" class="modal-body space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1" for="profileNameInput">Full Name</label>
                        <input type="text" id="profileNameInput" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-1" for="profileEmailInput">Email</label>
                        <input type="email" id="profileEmailInput" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-1" for="profileCompanyInput">Company</label>
                        <input type="text" id="profileCompanyInput" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-1" for="profileRoleInput">Role</label>
                        <select id="profileRoleInput" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                            <option value="Inventory Manager">Inventory Manager</option>
                            <option value="Venue Manager">Venue Manager</option>
                            <option value="Technician">Technician</option>
                            <option value="Administrator">Administrator</option>
                            <option value="Owner">Owner</option>
                        </select>
                    </div>
                </form>
                
                <div class="modal-footer">
                    <div class="flex justify-end space-x-4">
                        <button type="button" id="cancelProfileBtn" class="px-6 py-2 border rounded-lg hover:bg-gray-50">Cancel</button>
                        <button type="submit" id="submitProfileBtn" form="profileForm" class="px-6 py-2 bg-primary hover:bg-primary-dark text-white rounded-lg">
                            Save Changes
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Edit Company Name Modal -->
        <div id="companyNameModal" class="hidden fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl shadow-material-4 w-full max-w-md z-50">
            <div class="modal-container p-6">
                <div class="modal-header flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">Edit Company Name</h3>
                    <button id="closeCompanyNameModal" class="p-2 hover:bg-gray-100 rounded-full">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="companyNameForm" class="modal-body space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1" for="companyNameInput">Company Name *</label>
                        <input type="text" id="companyNameInput" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required>
                        <p class="text-xs text-gray-500 mt-1">This will update the name of your current journal</p>
                    </div>
                </form>
                
                <div class="modal-footer">
                    <div class="flex justify-end space-x-4">
                        <button type="button" id="cancelCompanyNameBtn" class="px-6 py-2 border rounded-lg hover:bg-gray-50">Cancel</button>
                        <button type="submit" id="submitCompanyNameBtn" form="companyNameForm" class="px-6 py-2 bg-primary hover:bg-primary-dark text-white rounded-lg">
                            Update Name
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- File Input for Journal Loading (Hidden) -->
    <input type="file" id="journalFileInput" accept=".json" class="hidden">
    
    <!-- File Input for Data Import (Hidden) -->
    <input type="file" id="dataImportInput" accept=".json" class="hidden">

    <!-- Service Worker Registration and App Script -->
    <script>
        // Generate a simple manifest for PWA
        const manifest = {
            "name": "Inventor - Inventory Manager",
            "short_name": "Inventor",
            "description": "PWA for venue inventory management and tech checks",
            "start_url": ".",
            "display": "standalone",
            "background_color": "#ffffff",
            "theme_color": "#1e88e5",
            "icons": [
                {
                    "src": "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMzYiIGZpbGw9IiMxRTg4RTUiLz4KPHBhdGggZD0iTTk2IDQ2QzExMS40NjQgNDYgMTI0IDU4LjUzNiAxMjQgNzRWNjRDMTI0IDQ4LjUzNiAxMTEuNDY0IDM2IDk2IDM2QzgwLjUzNiAzNiA2OCA0OC41MzYgNjggNjRWNzRDNjggNTguNTM2IDgwLjUzNiA0NiA5NiA0NloiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik03MiAxMjhIMTIwQzEzMi44IDExOC40IDE0NCAxMDcuMiAxNDQgOTZDMTQ0IDY4LjggMTIxLjIgNDggOTIgNDhDNTcuNiA0OCAzMiA3My42IDMyIDEwNEMzMiAxMjEuNiA0OC42IDEzNiA2OCAxMzZINzJWMjBIMTI4VjEzNkgxMzJIMTQ4VjE1MkgxMTJWMTkySDgwVjE1Mkg0NFYxMzZINjBWNzJINzJWMTI4WiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+Cg==",
                    "sizes": "192x192",
                    "type": "image/svg+xml"
                }
            ]
        };
        
        // Set the manifest
        document.getElementById('manifest').setAttribute('href', 'data:application/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(manifest)));
        
        // Simple QR Code Generator (minimal implementation)
        class SimpleQRCode {
            static generate(text, size = 200) {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                canvas.width = size;
                canvas.height = size;
                
                // Clear canvas
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, size, size);
                
                // Generate a simple pattern based on text hash
                const hash = this.hashCode(text);
                const seed = hash;
                
                // Draw QR pattern
                ctx.fillStyle = 'black';
                const moduleSize = Math.floor(size / 21);
                const offset = Math.floor((size - (moduleSize * 21)) / 2);
                
                // Position patterns
                this.drawPositionPattern(ctx, offset, offset, moduleSize);
                this.drawPositionPattern(ctx, offset + moduleSize * 14, offset, moduleSize);
                this.drawPositionPattern(ctx, offset, offset + moduleSize * 14, moduleSize);
                
                // Generate data based on hash
                const rng = this.seededRandom(seed);
                
                for (let y = 0; y < 21; y++) {
                    for (let x = 0; x < 21; x++) {
                        if ((x < 8 && y < 8) || (x > 12 && y < 8) || (x < 8 && y > 12)) {
                            continue;
                        }
                        
                        if (rng() > 0.5) {
                            ctx.fillRect(
                                offset + x * moduleSize, 
                                offset + y * moduleSize, 
                                moduleSize, 
                                moduleSize
                            );
                        }
                    }
                }
                
                // Add text at the bottom
                ctx.fillStyle = 'black';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(text, size/2, size - 10);
                
                return canvas;
            }
            
            static drawPositionPattern(ctx, x, y, size) {
                ctx.fillRect(x, y, size * 7, size * 7);
                ctx.fillStyle = 'white';
                ctx.fillRect(x + size, y + size, size * 5, size * 5);
                ctx.fillStyle = 'black';
                ctx.fillRect(x + size * 2, y + size * 2, size * 3, size * 3);
            }
            
            static hashCode(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return hash;
            }
            
            static seededRandom(seed) {
                let value = seed;
                return function() {
                    value = (value * 9301 + 49297) % 233280;
                    return value / 233280;
                };
            }
            
            static download(canvas, filename) {
                const link = document.createElement('a');
                link.download = filename;
                link.href = canvas.toDataURL('image/png');
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }
        
        // Dark Mode Manager
        class DarkModeManager {
            constructor() {
                this.isDarkMode = false;
                this.useSystemTheme = true;
                this.init();
            }
            
            init() {
                // Load preferences from localStorage
                const savedDarkMode = localStorage.getItem('inventor_darkMode');
                const savedSystemTheme = localStorage.getItem('inventor_useSystemTheme');
                
                if (savedDarkMode !== null) {
                    this.isDarkMode = savedDarkMode === 'true';
                    this.useSystemTheme = false;
                }
                
                if (savedSystemTheme !== null) {
                    this.useSystemTheme = savedSystemTheme === 'true';
                }
                
                // Apply initial theme
                this.applyTheme();
                
                // Listen for system theme changes
                this.watchSystemTheme();
            }
            
            applyTheme() {
                if (this.useSystemTheme) {
                    // Check system preference
                    const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    this.isDarkMode = systemPrefersDark;
                }
                
                // Apply to body
                if (this.isDarkMode) {
                    document.body.classList.add('dark-mode');
                    document.getElementById('darkModeIndicator')?.classList.remove('hidden');
                } else {
                    document.body.classList.remove('dark-mode');
                    document.getElementById('darkModeIndicator')?.classList.add('hidden');
                }
                
                // Update toggle switches
                this.updateToggleSwitches();
            }
            
            updateToggleSwitches() {
                const darkModeToggle = document.getElementById('darkModeToggle');
                const systemThemeToggle = document.getElementById('systemThemeToggle');
                const menuDarkModeToggle = document.getElementById('menuDarkModeToggle');
                
                if (darkModeToggle) darkModeToggle.checked = this.isDarkMode;
                if (systemThemeToggle) systemThemeToggle.checked = this.useSystemTheme;
                if (menuDarkModeToggle) menuDarkModeToggle.checked = this.isDarkMode;
            }
            
            watchSystemTheme() {
                // Watch for system theme changes
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                    if (this.useSystemTheme) {
                        this.isDarkMode = e.matches;
                        this.applyTheme();
                    }
                });
            }
            
            toggleDarkMode() {
                this.useSystemTheme = false;
                this.isDarkMode = !this.isDarkMode;
                this.savePreferences();
                this.applyTheme();
            }
            
            toggleSystemTheme() {
                this.useSystemTheme = !this.useSystemTheme;
                if (this.useSystemTheme) {
                    const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    this.isDarkMode = systemPrefersDark;
                }
                this.savePreferences();
                this.applyTheme();
            }
            
            savePreferences() {
                localStorage.setItem('inventor_darkMode', this.isDarkMode.toString());
                localStorage.setItem('inventor_useSystemTheme', this.useSystemTheme.toString());
            }
            
            getCurrentTheme() {
                return this.isDarkMode ? 'dark' : 'light';
            }
        }
        
        // App State
        const AppState = {
            company: null,
            venues: [],
            items: [],
            currentAudit: null,
            recentActivity: [],
            currentView: 'dash',
            userProfile: {
                name: "Inventor User",
                email: "",
                company: "",
                role: "Inventory Manager",
                memberSince: new Date().toISOString()
            },
            settings: {
                autoSave: true,
                auditReminders: true,
                stockAlerts: true,
                darkMode: false,
                useSystemTheme: true
            },
            darkModeManager: null,
            
            // Initialize from localStorage
            init() {
                const savedCompany = localStorage.getItem('inventor_company');
                const savedVenues = localStorage.getItem('inventor_venues');
                const savedItems = localStorage.getItem('inventor_items');
                const savedActivity = localStorage.getItem('inventor_activity');
                const savedProfile = localStorage.getItem('inventor_profile');
                const savedSettings = localStorage.getItem('inventor_settings');
                
                if (savedCompany) this.company = JSON.parse(savedCompany);
                if (savedVenues) this.venues = JSON.parse(savedVenues);
                if (savedItems) this.items = JSON.parse(savedItems);
                if (savedActivity) this.recentActivity = JSON.parse(savedActivity);
                if (savedProfile) this.userProfile = JSON.parse(savedProfile);
                if (savedSettings) this.settings = JSON.parse(savedSettings);
                
                // Initialize Dark Mode Manager
                this.darkModeManager = new DarkModeManager();
                
                this.updateUI();
                this.updateHeader();
                this.updateAuditVenues();
                this.updateAccountInfo();
            },
            
            // Update header based on journal state
            updateHeader() {
                const companyHeader = document.getElementById('companyHeader');
                const saveJournalBtn = document.getElementById('saveJournalBtn');
                const loadJournalHeaderBtn = document.getElementById('loadJournalHeaderBtn');
                
                if (this.company) {
                    companyHeader.textContent = this.company.name;
                    saveJournalBtn.classList.remove('hidden');
                    loadJournalHeaderBtn.classList.add('hidden');
                } else {
                    companyHeader.textContent = "Inventor";
                    saveJournalBtn.classList.add('hidden');
                    loadJournalHeaderBtn.classList.remove('hidden');
                }
            },
            
            // Save to localStorage
            save() {
                if (this.company) localStorage.setItem('inventor_company', JSON.stringify(this.company));
                localStorage.setItem('inventor_venues', JSON.stringify(this.venues));
                localStorage.setItem('inventor_items', JSON.stringify(this.items));
                localStorage.setItem('inventor_activity', JSON.stringify(this.recentActivity));
                localStorage.setItem('inventor_profile', JSON.stringify(this.userProfile));
                localStorage.setItem('inventor_settings', JSON.stringify(this.settings));
            },
            
            // Toggle load journal prompt visibility
            toggleLoadJournalPrompt() {
                const prompt = document.getElementById('loadJournalPrompt');
                if (this.company) {
                    prompt.classList.add('hidden');
                } else {
                    prompt.classList.remove('hidden');
                }
            },
            
            // Add activity log
            logActivity(action, details) {
                const timestamp = new Date().toISOString();
                this.recentActivity.unshift({
                    action,
                    details,
                    timestamp
                });
                
                // Keep only last 10 activities
                if (this.recentActivity.length > 10) {
                    this.recentActivity = this.recentActivity.slice(0, 10);
                }
                
                this.save();
                this.updateActivityLog();
            },
            
            // Update UI elements
            updateUI() {
                // Update counts
                document.getElementById('totalItems').textContent = this.items.length;
                document.getElementById('totalVenues').textContent = this.venues.length;
                
                const deployedCount = this.items.filter(item => item.status === 'DEPLOYED').length;
                const attentionCount = this.items.filter(item => item.status === 'BROKEN' || item.status === 'SERVICE').length;
                
                document.getElementById('deployedItems').textContent = deployedCount;
                document.getElementById('attentionItems').textContent = attentionCount;
                
                // Update venue filter dropdowns
                this.updateVenueFilters();
                
                // Update views
                this.updateInventoryList();
                this.updateVenuesList();
                this.updateActivityLog();
                this.updateAuditVenues();
                
                // Toggle load journal prompt
                this.toggleLoadJournalPrompt();
                
                // Update menu company name
                document.getElementById('menuCompanyName').textContent = this.company ? this.company.name : 'None loaded';
                
                // Update header
                this.updateHeader();
                
                // Update account info
                this.updateAccountInfo();
            },
            
            // Update account information
            updateAccountInfo() {
                // Profile info
                document.getElementById('accountUserName').textContent = this.userProfile.name;
                document.getElementById('accountUserRole').textContent = this.userProfile.role;
                document.getElementById('profileName').textContent = this.userProfile.name || 'Not Set';
                document.getElementById('profileEmail').textContent = this.userProfile.email || 'Not Set';
                document.getElementById('profileRole').textContent = this.userProfile.role || 'Inventory Manager';
                
                // Update current company name in account view
                const currentCompanyName = document.getElementById('currentCompanyName');
                if (this.company) {
                    currentCompanyName.textContent = this.company.name;
                    currentCompanyName.classList.remove('text-gray-500');
                    currentCompanyName.classList.add('text-primary');
                } else {
                    currentCompanyName.textContent = 'No journal loaded';
                    currentCompanyName.classList.remove('text-primary');
                    currentCompanyName.classList.add('text-gray-500');
                }
                
                // Format member since date
                if (this.userProfile.memberSince) {
                    const memberDate = new Date(this.userProfile.memberSince);
                    document.getElementById('memberSince').textContent = memberDate.toLocaleDateString();
                }
                
                // Update stats
                const auditCount = this.recentActivity.filter(activity => activity.action.includes('Audit')).length;
                document.getElementById('statItems').textContent = this.items.length;
                document.getElementById('statVenues').textContent = this.venues.length;
                document.getElementById('statAudits').textContent = auditCount;
                document.getElementById('statActivity').textContent = this.recentActivity.length;
                
                // Update storage usage
                this.updateStorageUsage();
            },
            
            // Update storage usage display
            updateStorageUsage() {
                // Calculate total storage used
                const data = {
                    company: this.company,
                    venues: this.venues,
                    items: this.items,
                    recentActivity: this.recentActivity,
                    userProfile: this.userProfile,
                    settings: this.settings
                };
                
                const jsonString = JSON.stringify(data);
                const bytes = new Blob([jsonString]).size;
                const kb = (bytes / 1024).toFixed(2);
                
                document.getElementById('storageUsed').textContent = `${kb} KB`;
                document.getElementById('storageItems').textContent = this.items.length;
                
                // Update storage bar (assuming 5MB max for demo)
                const maxStorage = 5 * 1024; // 5MB in KB
                const percentage = Math.min((kb / maxStorage) * 100, 100);
                document.getElementById('storageBar').style.width = `${percentage}%`;
            },
            
            // Update venue filter dropdowns
            updateVenueFilters() {
                const venueFilter = document.getElementById('filterVenue');
                const itemVenueSelect = document.getElementById('itemVenue');
                
                // Clear existing options (except first)
                while (venueFilter.options.length > 1) venueFilter.remove(1);
                while (itemVenueSelect.options.length > 1) itemVenueSelect.remove(1);
                
                // Add venue options
                this.venues.forEach(venue => {
                    const option = document.createElement('option');
                    option.value = venue.id;
                    option.textContent = venue.name;
                    venueFilter.appendChild(option.cloneNode(true));
                    itemVenueSelect.appendChild(option);
                });
                
                // Update tech check venues
                this.updateAuditVenues();
            },
            
            // Update inventory list
            updateInventoryList(filterStatus = '', filterVenue = '', searchTerm = '') {
                const inventoryList = document.getElementById('inventoryList');
                
                // Filter items
                let filteredItems = this.items;
                
                if (filterStatus) {
                    filteredItems = filteredItems.filter(item => item.status === filterStatus);
                }
                
                if (filterVenue) {
                    filteredItems = filteredItems.filter(item => item.venueId === filterVenue);
                }
                
                if (searchTerm) {
                    const term = searchTerm.toLowerCase();
                    filteredItems = filteredItems.filter(item => 
                        item.id.toLowerCase().includes(term) ||
                        (item.brand && item.brand.toLowerCase().includes(term)) ||
                        (item.model && item.model.toLowerCase().includes(term)) ||
                        (item.comment && item.comment.toLowerCase().includes(term))
                    );
                }
                
                if (filteredItems.length === 0) {
                    inventoryList.innerHTML = `
                        <div class="text-center py-12 text-gray-500">
                            <i class="fas fa-box-open text-4xl mb-4"></i>
                            <p class="text-lg">No inventory items found</p>
                            <p class="mt-2">Try adjusting your filters or add a new item</p>
                        </div>
                    `;
                    return;
                }
                
                // Generate inventory list HTML
                let html = '<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">';
                
                filteredItems.forEach(item => {
                    const venue = this.venues.find(v => v.id === item.venueId);
                    const statusClass = `status-${item.status.toLowerCase()}`;
                    
                    html += `
                        <div class="bg-white border rounded-lg p-4 shadow-material-1 hover:shadow-material-2 transition-shadow">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <h4 class="font-bold text-lg">${item.id}</h4>
                                    <p class="text-gray-600 text-sm">${item.brand || ''} ${item.model || ''}</p>
                                </div>
                                <span class="status-badge ${statusClass}">${item.status}</span>
                            </div>
                            
                            ${item.image ? `
                                <div class="mb-3 h-32 bg-gray-100 rounded-lg overflow-hidden">
                                    <img src="${item.image}" alt="${item.id}" class="w-full h-full object-cover">
                                </div>
                            ` : ''}
                            
                            <div class="mb-3">
                                ${item.categories && item.categories.length > 0 ? 
                                    `<div class="flex flex-wrap gap-1 mb-2">
                                        ${item.categories.map(cat => `<span class="px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">${cat}</span>`).join('')}
                                    </div>` : ''
                                }
                                ${item.comment ? `<p class="text-gray-700 text-sm">${item.comment}</p>` : ''}
                            </div>
                            
                            <div class="flex justify-between items-center text-sm">
                                <div>
                                    ${venue ? `<span class="text-gray-600"><i class="fas fa-building mr-1"></i>${venue.name}</span>` : '<span class="text-gray-400">Unassigned</span>'}
                                </div>
                                <div class="flex space-x-2">
                                    <button class="qr-item-btn p-2 text-green-600 hover:bg-green-50 rounded" data-id="${item.id}" title="Generate QR Code">
                                        <i class="fas fa-qrcode"></i>
                                    </button>
                                    <button class="edit-item-btn p-2 text-blue-600 hover:bg-blue-50 rounded" data-id="${item.id}">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="delete-item-btn p-2 text-red-600 hover:bg-red-50 rounded" data-id="${item.id}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                inventoryList.innerHTML = html;
                
                // Add event listeners to buttons
                document.querySelectorAll('.edit-item-btn').forEach(btn => {
                    btn.addEventListener('click', () => this.editItem(btn.dataset.id));
                });
                
                document.querySelectorAll('.delete-item-btn').forEach(btn => {
                    btn.addEventListener('click', () => this.deleteItem(btn.dataset.id));
                });
                
                document.querySelectorAll('.qr-item-btn').forEach(btn => {
                    btn.addEventListener('click', () => this.showQRCode(btn.dataset.id));
                });
            },
            
            // Show QR code for an item
            showQRCode(itemId) {
                const item = this.items.find(i => i.id === itemId);
                if (!item) return;
                
                // Clear previous QR code
                const qrContainer = document.getElementById('qrcode');
                qrContainer.innerHTML = '';
                
                // Set item info
                document.getElementById('qrItemId').textContent = item.id;
                document.getElementById('qrItemDetails').textContent = `${item.brand || ''} ${item.model || ''}`.trim() || 'No details';
                
                // Generate QR code
                const canvas = SimpleQRCode.generate(item.id, 200);
                qrContainer.appendChild(canvas);
                
                // Show modal
                this.showModal('qrCodeModal');
                
                // Setup download button
                document.getElementById('downloadQrCodeBtn').onclick = () => {
                    SimpleQRCode.download(canvas, `qr-code-${item.id}.png`);
                };
                
                // Setup print button
                document.getElementById('printQrCodeBtn').onclick = () => {
                    const printWindow = window.open('', '_blank');
                    printWindow.document.write(`
                        <html>
                            <head>
                                <title>QR Code - ${item.id}</title>
                                <style>
                                    body { font-family: Arial, sans-serif; margin: 20px; text-align: center; }
                                    .label { margin: 20px; display: inline-block; }
                                    .item-id { font-size: 18px; font-weight: bold; margin: 10px 0; }
                                    .item-details { color: #666; margin-bottom: 20px; }
                                    @media print {
                                        body { margin: 0; }
                                        .no-print { display: none; }
                                    }
                                </style>
                            </head>
                            <body>
                                <button class="no-print" onclick="window.print()" style="padding: 10px 20px; background: #1e88e5; color: white; border: none; border-radius: 5px; cursor: pointer; margin-bottom: 20px;">Print Labels</button>
                                <div class="label">
                                    <canvas id="qrCanvas"></canvas>
                                    <div class="item-id">${item.id}</div>
                                    <div class="item-details">${item.brand || ''} ${item.model || ''}</div>
                                </div>
                                <script>
                                    const canvas = document.getElementById('qrCanvas');
                                    const ctx = canvas.getContext('2d');
                                    const img = new Image();
                                    img.onload = function() {
                                        canvas.width = 200;
                                        canvas.height = 200;
                                        ctx.drawImage(img, 0, 0, 200, 200);
                                    };
                                    img.src = '${canvas.toDataURL()}';
                                <\/script>
                            </body>
                        </html>
                    `);
                    printWindow.document.close();
                };
            },
            
            // Update venues list
            updateVenuesList() {
                const venuesList = document.getElementById('venuesList');
                
                if (this.venues.length === 0) {
                    venuesList.innerHTML = `
                        <div class="text-center py-12 text-gray-500 col-span-full">
                            <i class="fas fa-building text-4xl mb-4"></i>
                            <p class="text-lg">No venues found</p>
                            <p class="mt-2">Add your first venue</p>
                        </div>
                    `;
                    return;
                }
                
                // Generate venues list HTML
                let html = '';
                
                this.venues.forEach(venue => {
                    const assignedItems = this.items.filter(item => item.venueId === venue.id).length;
                    
                    html += `
                        <div class="bg-white border rounded-lg p-5 shadow-material-1 hover:shadow-material-2 transition-shadow">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <h4 class="font-bold text-lg">${venue.name}</h4>
                                    ${venue.address ? `<p class="text-gray-600 text-sm"><i class="fas fa-map-marker-alt mr-1"></i>${venue.address}</p>` : ''}
                                </div>
                                <div class="flex space-x-2">
                                    <button class="edit-venue-btn p-2 text-blue-600 hover:bg-blue-50 rounded" data-id="${venue.id}">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="delete-venue-btn p-2 text-red-600 hover:bg-red-50 rounded" data-id="${venue.id}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                ${venue.contact ? `<p class="text-gray-700 text-sm"><i class="fas fa-user mr-1"></i>${venue.contact}</p>` : ''}
                                ${venue.phone ? `<p class="text-gray-700 text-sm"><i class="fas fa-phone mr-1"></i>${venue.phone}</p>` : ''}
                                ${venue.notes ? `<p class="text-gray-700 text-sm mt-2">${venue.notes}</p>` : ''}
                            </div>
                            
                            <div class="flex justify-between items-center text-sm">
                                <div>
                                    <span class="font-medium">${assignedItems}</span> item${assignedItems !== 1 ? 's' : ''} assigned
                                </div>
                                <button class="venue-tech-check-btn px-3 py-1 bg-primary hover:bg-primary-dark text-white rounded text-sm" data-id="${venue.id}">
                                    <i class="fas fa-clipboard-check mr-1"></i> Audit
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                venuesList.innerHTML = html;
                
                // Add event listeners to edit/delete buttons
                document.querySelectorAll('.edit-venue-btn').forEach(btn => {
                    btn.addEventListener('click', () => this.editVenue(btn.dataset.id));
                });
                
                document.querySelectorAll('.delete-venue-btn').forEach(btn => {
                    btn.addEventListener('click', () => this.deleteVenue(btn.dataset.id));
                });
                
                // Add event listeners to tech check buttons
                document.querySelectorAll('.venue-tech-check-btn').forEach(btn => {
                    btn.addEventListener('click', () => this.startAudit(btn.dataset.id));
                });
            },
            
            // Update activity log
            updateActivityLog() {
                const activityLog = document.getElementById('recentActivity');
                
                if (this.recentActivity.length === 0) {
                    activityLog.innerHTML = `
                        <div class="text-gray-500 text-center py-8">
                            <i class="fas fa-history text-3xl mb-3"></i>
                            <p>No recent activity</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                
                this.recentActivity.forEach(activity => {
                    const date = new Date(activity.timestamp);
                    const timeString = date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    const dateString = date.toLocaleDateString();
                    
                    html += `
                        <div class="flex items-start p-3 bg-gray-50 rounded-lg">
                            <div class="bg-primary text-white p-2 rounded-full mr-3">
                                <i class="fas fa-${this.getActivityIcon(activity.action)} text-sm"></i>
                            </div>
                            <div>
                                <p class="font-medium">${activity.action}</p>
                                <p class="text-gray-600 text-sm">${activity.details}</p>
                                <p class="text-gray-500 text-xs mt-1">${dateString} ${timeString}</p>
                            </div>
                        </div>
                    `;
                });
                
                activityLog.innerHTML = html;
            },
            
            // Get icon for activity type
            getActivityIcon(action) {
                if (action.includes('Added')) return 'plus';
                if (action.includes('Updated')) return 'edit';
                if (action.includes('Deleted')) return 'trash';
                if (action.includes('Audit')) return 'clipboard-check';
                if (action.includes('Loaded')) return 'folder-open';
                if (action.includes('Exported')) return 'file-export';
                return 'history';
            },
            
            // Update tech check venues
            updateAuditVenues() {
                const auditVenues = document.getElementById('auditVenues');
                
                // Get venues that have items assigned
                const venuesWithItems = this.venues.filter(venue => 
                    this.items.some(item => item.venueId === venue.id)
                );
                
                if (venuesWithItems.length === 0) {
                    auditVenues.innerHTML = `
                        <div class="col-span-full text-center py-8 text-gray-500">
                            <i class="fas fa-map-marker-alt text-3xl mb-3"></i>
                            <p>No venues available for tech check</p>
                            <p class="text-sm mt-1">Add venues and assign inventory items first</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                
                venuesWithItems.forEach(venue => {
                    const itemCount = this.items.filter(item => item.venueId === venue.id).length;
                    
                    html += `
                        <button class="tech-check-venue-btn bg-white border rounded-xl shadow-material-1 hover:shadow-material-2 transition-shadow text-left p-6" data-id="${venue.id}">
                            <div class="flex items-start">
                                <div class="bg-primary text-white p-3 rounded-full mr-4">
                                    <i class="fas fa-building"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-lg">${venue.name}</h4>
                                    <p class="text-gray-600 text-sm mt-1">${itemCount} item${itemCount !== 1 ? 's' : ''} to check</p>
                                    ${venue.address ? `<p class="text-gray-500 text-xs mt-2"><i class="fas fa-map-marker-alt mr-1"></i>${venue.address}</p>` : ''}
                                </div>
                            </div>
                        </button>
                    `;
                });
                
                auditVenues.innerHTML = html;
                
                // Add event listeners to tech check venue buttons
                document.querySelectorAll('.tech-check-venue-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.startAudit(btn.dataset.id);
                    });
                });
            },
            
            // Start tech check for a venue
            startAudit(venueId) {
                const venue = this.venues.find(v => v.id === venueId);
                if (!venue) {
                    alert('Venue not found!');
                    return;
                }
                
                // Get all items assigned to this venue
                const venueItems = this.items.filter(item => item.venueId === venueId);
                
                if (venueItems.length === 0) {
                    alert('No items assigned to this venue!');
                    return;
                }
                
                this.currentAudit = {
                    venueId: venue.id,
                    venueName: venue.name,
                    items: venueItems,
                    startTime: new Date().toISOString()
                };
                
                // Switch to tech check view
                this.showView('audit');
                
                // Hide step 1, show step 2
                document.getElementById('auditStep1').classList.add('hidden');
                document.getElementById('auditStep2').classList.remove('hidden');
                document.getElementById('auditCompleteStep').classList.add('hidden');
                
                // Set venue name
                document.getElementById('completedVenueName').textContent = venue.name;
                
                // Generate tech check items
                const auditItems = document.getElementById('auditItems');
                let html = '';
                
                venueItems.forEach((item, index) => {
                    html += `
                        <div class="tech-check-item bg-gray-50 rounded-lg p-4">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <h4 class="font-bold text-lg">${item.id}</h4>
                                    <p class="text-gray-600 text-sm">${item.brand || ''} ${item.model || ''}</p>
                                    ${item.categories && item.categories.length > 0 ? 
                                        `<div class="flex flex-wrap gap-1 mt-1">
                                            ${item.categories.map(cat => `<span class="px-2 py-1 bg-gray-200 text-gray-700 text-xs rounded">${cat}</span>`).join('')}
                                        </div>` : ''
                                    }
                                </div>
                                <span class="status-badge status-${item.status.toLowerCase()}">${item.status}</span>
                            </div>
                            
                            <div class="mb-3">
                                <label class="block text-sm font-medium mb-2">Status after check:</label>
                                <div class="flex flex-wrap gap-2">
                                    <label class="inline-flex items-center">
                                        <input type="radio" name="status_${item.id}" value="DEPLOYED" ${item.status === 'DEPLOYED' ? 'checked' : ''} class="mr-2">
                                        <span class="status-badge status-deployed">Deployed</span>
                                    </label>
                                    <label class="inline-flex items-center">
                                        <input type="radio" name="status_${item.id}" value="RESERVE" ${item.status === 'RESERVE' ? 'checked' : ''} class="mr-2">
                                        <span class="status-badge status-reserve">Reserve</span>
                                    </label>
                                    <label class="inline-flex items-center">
                                        <input type="radio" name="status_${item.id}" value="BROKEN" ${item.status === 'BROKEN' ? 'checked' : ''} class="mr-2">
                                        <span class="status-badge status-broken">Broken</span>
                                    </label>
                                    <label class="inline-flex items-center">
                                        <input type="radio" name="status_${item.id}" value="SERVICE" ${item.status === 'SERVICE' ? 'checked' : ''} class="mr-2">
                                        <span class="status-badge status-service">Service</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-1">Check Notes (optional):</label>
                                <textarea class="w-full px-3 py-2 border rounded-lg text-sm tech-check-notes" data-id="${item.id}" placeholder="Any notes about this item's condition..."></textarea>
                            </div>
                        </div>
                    `;
                });
                
                auditItems.innerHTML = html;
                
                // Scroll to top
                window.scrollTo(0, 0);
            },
            
            // Complete tech check
            completeAudit() {
                if (!this.currentAudit) return;
                
                const venueId = this.currentAudit.venueId;
                const venueItems = this.currentAudit.items;
                let changesMade = false;
                
                // Update each item's status based on radio buttons
                venueItems.forEach(item => {
                    const radioGroup = document.querySelector(`input[name="status_${item.id}"]:checked`);
                    const notesField = document.querySelector(`.tech-check-notes[data-id="${item.id}"]`);
                    
                    if (radioGroup && radioGroup.value !== item.status) {
                        item.status = radioGroup.value;
                        changesMade = true;
                    }
                    
                    // Add notes if provided
                    if (notesField && notesField.value.trim()) {
                        if (!item.auditNotes) item.auditNotes = [];
                        item.auditNotes.push({
                            date: new Date().toISOString(),
                            notes: notesField.value.trim()
                        });
                        changesMade = true;
                    }
                });
                
                // Log activity if changes were made
                if (changesMade) {
                    const venue = this.venues.find(v => v.id === venueId);
                    this.logActivity('Audit Completed', `Updated equipment status at ${venue.name}`);
                    this.save();
                    this.updateUI();
                }
                
                // Show completion step
                document.getElementById('auditStep2').classList.add('hidden');
                document.getElementById('auditCompleteStep').classList.remove('hidden');
                
                // Update current tech check
                this.currentAudit.endTime = new Date().toISOString();
                this.currentAudit.changesMade = changesMade;
            },
            
            // Generate tech check report
            generateAuditReport() {
                if (!this.currentAudit) return;
                
                const venue = this.venues.find(v => v.id === this.currentAudit.venueId);
                const venueItems = this.currentAudit.items;
                
                const startTime = new Date(this.currentAudit.startTime);
                const endTime = this.currentAudit.endTime ? new Date(this.currentAudit.endTime) : new Date();
                
                let reportHtml = `
                    <div class="mb-6">
                        <h4 class="font-bold text-lg mb-2">Audit Report</h4>
                        <div class="grid md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <p class="text-sm text-gray-600">Venue</p>
                                <p class="font-medium">${venue.name}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Date</p>
                                <p class="font-medium">${endTime.toLocaleDateString()} ${endTime.toLocaleTimeString()}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h5 class="font-bold mb-3">Equipment Summary</h5>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="bg-gray-100">
                                        <th class="text-left p-2">Item ID</th>
                                        <th class="text-left p-2">Brand/Model</th>
                                        <th class="text-left p-2">Category</th>
                                        <th class="text-left p-2">Status</th>
                                        <th class="text-left p-2">Notes</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;
                
                venueItems.forEach(item => {
                    const lastNote = item.auditNotes && item.auditNotes.length > 0 
                        ? item.auditNotes[item.auditNotes.length - 1].notes
                        : '';
                    
                    reportHtml += `
                        <tr class="border-b">
                            <td class="p-2 font-medium">${item.id}</td>
                            <td class="p-2">${item.brand || ''} ${item.model || ''}</td>
                            <td class="p-2">${item.categories ? item.categories.join(', ') : ''}</td>
                            <td class="p-2"><span class="status-badge status-${item.status.toLowerCase()}">${item.status}</span></td>
                            <td class="p-2">${lastNote}</td>
                        </tr>
                    `;
                });
                
                reportHtml += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h5 class="font-bold mb-2">Summary</h5>
                        <p>Total items checked: <span class="font-medium">${venueItems.length}</span></p>
                        <p>Check duration: <span class="font-medium">${Math.round((endTime - startTime) / 60000)} minutes</span></p>
                        <p class="mt-2 text-sm">Report generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}</p>
                    </div>
                `;
                
                document.getElementById('reportContent').innerHTML = reportHtml;
                this.showModal('reportModal');
            },
            
            // Add new item
            addItem(itemData) {
                // Generate ID if not provided
                if (!itemData.id) {
                    itemData.id = 'ITEM-' + Date.now().toString().slice(-6);
                }
                
                // Ensure categories is an array
                if (!Array.isArray(itemData.categories)) {
                    itemData.categories = itemData.categories ? [itemData.categories] : [];
                }
                
                this.items.push(itemData);
                this.save();
                this.updateUI();
                this.logActivity('Item Added', `Added ${itemData.id} to inventory`);
            },
            
            // Edit existing item
            editItem(itemId) {
                const item = this.items.find(i => i.id === itemId);
                if (!item) return;
                
                // Populate form
                document.getElementById('itemId').value = item.id;
                document.getElementById('itemUniqueId').value = item.id;
                document.getElementById('itemBrand').value = item.brand || '';
                document.getElementById('itemModel').value = item.model || '';
                document.getElementById('itemStatus').value = item.status || '';
                document.getElementById('itemVenue').value = item.venueId || '';
                document.getElementById('itemComment').value = item.comment || '';
                
                // Update categories display
                const selectedCategories = document.getElementById('selectedCategories');
                selectedCategories.innerHTML = '';
                
                if (item.categories && item.categories.length > 0) {
                    item.categories.forEach(category => {
                        const span = document.createElement('span');
                        span.className = 'px-2 py-1 bg-gray-100 text-gray-700 text-sm rounded mr-2 mb-1 inline-flex items-center';
                        span.innerHTML = `${category} <button type="button" class="ml-1 text-gray-500 remove-category" data-category="${category}"><i class="fas fa-times"></i></button>`;
                        selectedCategories.appendChild(span);
                    });
                }
                
                // Update image preview if available
                const imagePreview = document.getElementById('itemImagePreview');
                const removeImageBtn = document.getElementById('itemImageRemoveBtn');
                if (item.image) {
                    imagePreview.innerHTML = `<img src="${item.image}" alt="Item image" class="w-full h-full object-cover rounded-lg">`;
                    removeImageBtn.classList.remove('hidden');
                } else {
                    imagePreview.innerHTML = '<i class="fas fa-camera text-gray-400 text-4xl"></i>';
                    removeImageBtn.classList.add('hidden');
                }
                
                // Update modal title
                document.getElementById('itemModalTitle').textContent = 'Edit Inventory Item';
                
                // Show modal
                this.showModal('itemModal');
            },
            
            // Save item (from form)
            saveItem(formData) {
                const itemId = document.getElementById('itemId').value;
                const isEdit = itemId !== '';
                
                // Get selected categories
                const categoryElements = document.getElementById('selectedCategories').querySelectorAll('span');
                const categories = Array.from(categoryElements).map(el => {
                    return el.textContent.replace('', '').trim();
                });
                
                // Build item object
                const itemData = {
                    id: document.getElementById('itemUniqueId').value,
                    brand: document.getElementById('itemBrand').value,
                    model: document.getElementById('itemModel').value,
                    categories: categories,
                    status: document.getElementById('itemStatus').value,
                    venueId: document.getElementById('itemVenue').value || null,
                    comment: document.getElementById('itemComment').value,
                    lastUpdated: new Date().toISOString()
                };
                
                // Handle image if present
                const imageInput = document.getElementById('itemImage');
                if (imageInput.files && imageInput.files[0]) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        itemData.image = e.target.result;
                        this.finalizeItemSave(itemData, isEdit);
                    };
                    reader.readAsDataURL(imageInput.files[0]);
                } else {
                    // Keep existing image if editing
                    if (isEdit) {
                        const existingItem = this.items.find(i => i.id === itemId);
                        if (existingItem && existingItem.image) {
                            itemData.image = existingItem.image;
                        }
                    }
                    this.finalizeItemSave(itemData, isEdit);
                }
            },
            
            // Finalize item save
            finalizeItemSave(itemData, isEdit) {
                if (isEdit) {
                    // Update existing item
                    const index = this.items.findIndex(i => i.id === document.getElementById('itemId').value);
                    if (index !== -1) {
                        this.items[index] = itemData;
                        this.logActivity('Item Updated', `Updated ${itemData.id}`);
                    }
                } else {
                    // Add new item
                    this.addItem(itemData);
                }
                
                this.save();
                this.updateUI();
                this.hideModal('itemModal');
                
                // Reset form
                document.getElementById('itemForm').reset();
                document.getElementById('selectedCategories').innerHTML = '';
                document.getElementById('itemImagePreview').innerHTML = '<i class="fas fa-camera text-gray-400 text-4xl"></i>';
                document.getElementById('itemImageRemoveBtn').classList.add('hidden');
                document.getElementById('itemImage').value = '';
            },
            
            // Delete item
            deleteItem(itemId) {
                if (confirm('Are you sure you want to delete this item? This action cannot be undone.')) {
                    const item = this.items.find(i => i.id === itemId);
                    const index = this.items.findIndex(i => i.id === itemId);
                    
                    if (index !== -1) {
                        this.items.splice(index, 1);
                        this.save();
                        this.updateUI();
                        this.logActivity('Item Deleted', `Deleted ${itemId} from inventory`);
                    }
                }
            },
            
            // Add new venue
            addVenue(venueData) {
                // Generate ID if not provided
                if (!venueData.id) {
                    venueData.id = 'VENUE-' + Date.now().toString().slice(-6);
                }
                
                this.venues.push(venueData);
                this.save();
                this.updateUI();
                this.logActivity('Venue Added', `Added ${venueData.name}`);
            },
            
            // Edit existing venue
            editVenue(venueId) {
                const venue = this.venues.find(v => v.id === venueId);
                if (!venue) return;
                
                // Populate form
                document.getElementById('venueId').value = venue.id;
                document.getElementById('venueName').value = venue.name;
                document.getElementById('venueAddress').value = venue.address || '';
                document.getElementById('venueContact').value = venue.contact || '';
                document.getElementById('venuePhone').value = venue.phone || '';
                document.getElementById('venueNotes').value = venue.notes || '';
                
                // Update modal title
                document.getElementById('venueModalTitle').textContent = 'Edit Venue';
                
                // Show modal
                this.showModal('venueModal');
            },
            
            // Save venue (from form)
            saveVenue() {
                const venueId = document.getElementById('venueId').value;
                const isEdit = venueId !== '';
                
                // Build venue object
                const venueData = {
                    id: venueId || 'VENUE-' + Date.now().toString().slice(-6),
                    name: document.getElementById('venueName').value,
                    address: document.getElementById('venueAddress').value,
                    contact: document.getElementById('venueContact').value,
                    phone: document.getElementById('venuePhone').value,
                    notes: document.getElementById('venueNotes').value
                };
                
                if (isEdit) {
                    // Update existing venue
                    const index = this.venues.findIndex(v => v.id === venueId);
                    if (index !== -1) {
                        this.venues[index] = venueData;
                        this.logActivity('Venue Updated', `Updated ${venueData.name}`);
                    }
                } else {
                    // Add new venue
                    this.addVenue(venueData);
                }
                
                this.save();
                this.updateUI();
                this.hideModal('venueModal');
                
                // Reset form
                document.getElementById('venueForm').reset();
            },
            
            // Delete venue
            deleteVenue(venueId) {
                // Check if any items are assigned to this venue
                const assignedItems = this.items.filter(item => item.venueId === venueId);
                
                if (assignedItems.length > 0) {
                    if (!confirm(`This venue has ${assignedItems.length} item(s) assigned. Deleting it will unassign these items. Continue?`)) {
                        return;
                    }
                    
                    // Unassign items from this venue
                    assignedItems.forEach(item => {
                        item.venueId = null;
                    });
                }
                
                const venue = this.venues.find(v => v.id === venueId);
                const index = this.venues.findIndex(v => v.id === venueId);
                
                if (index !== -1) {
                    this.venues.splice(index, 1);
                    this.save();
                    this.updateUI();
                    this.logActivity('Venue Deleted', `Deleted ${venue.name}`);
                }
            },
            
            // Load journal from JSON
            loadJournal(jsonData) {
                try {
                    const journal = JSON.parse(jsonData);
                    
                    // Validate journal structure
                    if (!journal.company || !journal.company.name) {
                        throw new Error('Invalid journal format: Missing company information');
                    }
                    
                    // Clear existing data
                    this.company = journal.company;
                    this.venues = journal.venues || [];
                    this.items = journal.items || [];
                    this.recentActivity = [];
                    
                    // Save to localStorage
                    this.save();
                    
                    // Log activity
                    this.logActivity('Journal Loaded', `Loaded ${journal.company.name} journal`);
                    
                    // Update UI
                    this.updateUI();
                    
                    // Show success message
                    alert(`Successfully loaded ${journal.company.name} journal with ${this.items.length} items and ${this.venues.length} venues.`);
                    
                    // Switch to dash view
                    this.showView('dash');
                    
                } catch (error) {
                    alert('Error loading journal: ' + error.message);
                    console.error(error);
                }
            },
            
            // Export journal as JSON
            exportJournal() {
                if (!this.company) {
                    alert('Please load or create a journal first.');
                    return;
                }
                
                const journal = {
                    company: this.company,
                    venues: this.venues,
                    items: this.items,
                    exported: new Date().toISOString()
                };
                
                const jsonString = JSON.stringify(journal, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `inventor-${this.company.name.replace(/\s+/g, '-').toLowerCase()}-${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.logActivity('Journal Exported', `Exported ${this.company.name} journal`);
            },
            
            // Export all data including settings and profile
            exportAllData() {
                const allData = {
                    company: this.company,
                    venues: this.venues,
                    items: this.items,
                    recentActivity: this.recentActivity,
                    userProfile: this.userProfile,
                    settings: this.settings,
                    exported: new Date().toISOString(),
                    version: '1.0'
                };
                
                const jsonString = JSON.stringify(allData, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `inventor-full-backup-${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.logActivity('Full Backup Created', 'Exported complete application data');
                alert('Full backup created successfully!');
            },
            
            // Import all data
            importAllData(jsonData) {
                try {
                    const data = JSON.parse(jsonData);
                    
                    // Validate data structure
                    if (!data.version) {
                        throw new Error('Invalid backup format');
                    }
                    
                    // Import data
                    if (data.company) this.company = data.company;
                    if (data.venues) this.venues = data.venues;
                    if (data.items) this.items = data.items;
                    if (data.recentActivity) this.recentActivity = data.recentActivity;
                    if (data.userProfile) this.userProfile = data.userProfile;
                    if (data.settings) this.settings = data.settings;
                    
                    // Save to localStorage
                    this.save();
                    
                    // Update UI
                    this.updateUI();
                    
                    // Log activity
                    this.logActivity('Full Backup Restored', 'Imported complete application data');
                    
                    alert('Backup restored successfully!');
                    
                } catch (error) {
                    alert('Error importing backup: ' + error.message);
                    console.error(error);
                }
            },
            
            // Create a new journal
            createNewJournal() {
                const companyName = prompt('Enter company name for new journal:');
                if (!companyName) return;
                
                this.company = {
                    name: companyName,
                    created: new Date().toISOString()
                };
                
                this.venues = [];
                this.items = [];
                this.recentActivity = [];
                
                this.save();
                this.updateUI();
                this.logActivity('New Journal Created', `Created journal for ${companyName}`);
                
                // Switch to dash view
                this.showView('dash');
            },
            
            // Clear all data
            clearAllData() {
                if (confirm('Are you sure you want to clear all data? This will remove all inventory items, venues, and settings. This action cannot be undone.')) {
                    localStorage.clear();
                    this.company = null;
                    this.venues = [];
                    this.items = [];
                    this.recentActivity = [];
                    this.userProfile = {
                        name: "Inventor User",
                        email: "",
                        company: "",
                        role: "Inventory Manager",
                        memberSince: new Date().toISOString()
                    };
                    this.settings = {
                        autoSave: true,
                        auditReminders: true,
                        stockAlerts: true,
                        darkMode: false,
                        useSystemTheme: true
                    };
                    
                    // Reset UI
                    this.updateUI();
                    
                    // Show dash
                    this.showView('dash');
                    
                    // Close menu
                    this.hideMenu();
                    
                    alert('All data has been cleared.');
                    
                    // Reload dark mode settings
                    this.darkModeManager.init();
                }
            },
            
            // Edit user profile
            editProfile() {
                // Populate form with current profile data
                document.getElementById('profileNameInput').value = this.userProfile.name || '';
                document.getElementById('profileEmailInput').value = this.userProfile.email || '';
                document.getElementById('profileRoleInput').value = this.userProfile.role || 'Inventory Manager';
                
                // Show modal
                this.showModal('profileModal');
            },
            
            // Save user profile
            saveProfile() {
                // Update profile
                this.userProfile.name = document.getElementById('profileNameInput').value || 'Inventor User';
                this.userProfile.email = document.getElementById('profileEmailInput').value;
                this.userProfile.role = document.getElementById('profileRoleInput').value;
                
                // Save to localStorage
                this.save();
                
                // Update UI
                this.updateUI();
                
                // Hide modal
                this.hideModal('profileModal');
                
                // Log activity
                this.logActivity('Profile Updated', 'Updated user profile information');
                
                alert('Profile updated successfully!');
            },
            
            // Edit company name
            editCompanyName() {
                if (!this.company) {
                    alert('No journal loaded. Please load a journal first.');
                    return;
                }
                
                // Populate form with current company name
                document.getElementById('companyNameInput').value = this.company.name;
                
                // Show modal
                this.showModal('companyNameModal');
            },
            
            // Save company name
            saveCompanyName() {
                if (!this.company) {
                    alert('No journal loaded. Cannot update company name.');
                    return;
                }
                
                const newName = document.getElementById('companyNameInput').value.trim();
                if (!newName) {
                    alert('Company name cannot be empty.');
                    return;
                }
                
                const oldName = this.company.name;
                this.company.name = newName;
                this.company.lastUpdated = new Date().toISOString();
                
                // Save to localStorage
                this.save();
                
                // Update UI
                this.updateUI();
                
                // Hide modal
                this.hideModal('companyNameModal');
                
                // Log activity
                this.logActivity('Company Name Updated', `Changed from "${oldName}" to "${newName}"`);
                
                alert('Company name updated successfully!');
            },
            
            // Show a specific view
            showView(viewName) {
                // Hide all views
                document.querySelectorAll('[id$="View"]').forEach(view => {
                    view.classList.add('hidden');
                });
                
                // Show requested view
                const viewId = viewName + 'View';
                const viewElement = document.getElementById(viewId);
                if (viewElement) {
                    viewElement.classList.remove('hidden');
                } else {
                    console.error(`View element with ID "${viewId}" not found`);
                    // Fallback to dash
                    document.getElementById('dashView').classList.remove('hidden');
                }
                
                // Update bottom navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    if (item.dataset.tab === viewName) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });
                
                // Update current view
                this.currentView = viewName;
                
                // Close menu if open
                this.hideMenu();
            },
            
            // Show modal
            showModal(modalId) {
                document.getElementById('modalBackdrop').classList.remove('hidden');
                document.getElementById(modalId).classList.remove('hidden');
            },
            
            // Hide modal
            hideModal(modalId) {
                document.getElementById('modalBackdrop').classList.add('hidden');
                if (modalId) {
                    document.getElementById(modalId).classList.add('hidden');
                } else {
                    // Hide all modals
                    document.querySelectorAll('[id$="Modal"]').forEach(modal => {
                        if (modal.id !== 'installPrompt') {
                            modal.classList.add('hidden');
                        }
                    });
                }
            },
            
            // Show side menu
            showMenu() {
                document.getElementById('sideMenu').classList.remove('translate-x-full');
            },
            
            // Hide side menu
            hideMenu() {
                document.getElementById('sideMenu').classList.add('translate-x-full');
            }
        };
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize app state
            AppState.init();
            
            // PWA Install Prompt
            let deferredPrompt;
            const installPrompt = document.getElementById('installPrompt');
            const installConfirm = document.getElementById('installConfirm');
            const installCancel = document.getElementById('installCancel');
            
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                
                // Show install prompt after a delay
                setTimeout(() => {
                    if (!localStorage.getItem('inventor_installPromptShown')) {
                        installPrompt.classList.remove('hidden');
                        localStorage.setItem('inventor_installPromptShown', 'true');
                    }
                }, 3000);
            });
            
            installConfirm.addEventListener('click', () => {
                installPrompt.classList.add('hidden');
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('User accepted the install prompt');
                        }
                        deferredPrompt = null;
                    });
                }
            });
            
            installCancel.addEventListener('click', () => {
                installPrompt.classList.add('hidden');
            });
            
            // Event Listeners
            
            // Load journal buttons
            document.getElementById('loadJournalHeaderBtn').addEventListener('click', () => {
                document.getElementById('journalFileInput').click();
            });
            
            document.getElementById('promptLoadJournalBtn').addEventListener('click', () => {
                document.getElementById('journalFileInput').click();
            });
            
            document.getElementById('loadJournalBtn').addEventListener('click', () => {
                document.getElementById('journalFileInput').click();
            });
            
            // Save journal button
            document.getElementById('saveJournalBtn').addEventListener('click', () => {
                AppState.exportJournal();
            });
            
            document.getElementById('exportJournalBtn').addEventListener('click', () => {
                AppState.exportJournal();
            });
            
            // Journal file input
            document.getElementById('journalFileInput').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    AppState.loadJournal(event.target.result);
                };
                reader.readAsText(file);
                
                // Reset file input
                e.target.value = '';
            });
            
            // Bottom navigation items
            document.querySelectorAll('.nav-item[data-tab]').forEach(item => {
                item.addEventListener('click', () => {
                    AppState.showView(item.dataset.tab);
                });
            });
            
            // Bottom menu button
            document.getElementById('bottomMenuBtn').addEventListener('click', () => {
                AppState.showMenu();
            });
            
            // Close menu button
            document.getElementById('closeMenuBtn').addEventListener('click', () => {
                AppState.hideMenu();
            });
            
            // Menu items
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    const tab = e.currentTarget.dataset.tab;
                    if (tab) {
                        AppState.showView(tab);
                    }
                });
            });
            
            // Menu actions
            document.getElementById('menuExport').addEventListener('click', () => {
                AppState.exportJournal();
                AppState.hideMenu();
            });
            
            document.getElementById('menuImport').addEventListener('click', () => {
                document.getElementById('journalFileInput').click();
                AppState.hideMenu();
            });
            
            document.getElementById('menuClearData').addEventListener('click', () => {
                AppState.clearAllData();
            });
            
            // Quick action buttons
            document.getElementById('quickAddItem').addEventListener('click', () => {
                AppState.showView('inventory');
                // Reset form for new item
                document.getElementById('itemForm').reset();
                document.getElementById('selectedCategories').innerHTML = '';
                document.getElementById('itemImagePreview').innerHTML = '<i class="fas fa-camera text-gray-400 text-4xl"></i>';
                document.getElementById('itemImageRemoveBtn').classList.add('hidden');
                document.getElementById('itemImage').value = '';
                document.getElementById('itemModalTitle').textContent = 'Add Inventory Item';
                document.getElementById('itemId').value = '';
                AppState.showModal('itemModal');
            });
            
            document.getElementById('quickAudit').addEventListener('click', () => {
                AppState.showView('audit');
            });
            
            document.getElementById('quickAddVenue').addEventListener('click', () => {
                AppState.showView('venues');
                // Reset form for new venue
                document.getElementById('venueForm').reset();
                document.getElementById('venueModalTitle').textContent = 'Add Venue';
                document.getElementById('venueId').value = '';
                AppState.showModal('venueModal');
            });
            
            // Add item button
            document.getElementById('addItemBtn').addEventListener('click', () => {
                // Reset form for new item
                document.getElementById('itemForm').reset();
                document.getElementById('selectedCategories').innerHTML = '';
                document.getElementById('itemImagePreview').innerHTML = '<i class="fas fa-camera text-gray-400 text-4xl"></i>';
                document.getElementById('itemImageRemoveBtn').classList.add('hidden');
                document.getElementById('itemImage').value = '';
                document.getElementById('itemModalTitle').textContent = 'Add Inventory Item';
                document.getElementById('itemId').value = '';
                AppState.showModal('itemModal');
            });
            
            // Item form
            document.getElementById('itemForm').addEventListener('submit', (e) => {
                e.preventDefault();
                AppState.saveItem();
            });
            
            // Submit item button (explicit)
            document.getElementById('submitItemBtn').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('itemForm').dispatchEvent(new Event('submit'));
            });
            
            // QR Code button
            document.getElementById('qrCodeBtn').addEventListener('click', () => {
                const itemId = document.getElementById('itemUniqueId').value;
                if (itemId.trim()) {
                    // Show QR code for current item ID
                    const tempItem = { id: itemId };
                    AppState.showQRCode = function() {
                        // Clear previous QR code
                        const qrContainer = document.getElementById('qrcode');
                        qrContainer.innerHTML = '';
                        
                        // Set item info
                        document.getElementById('qrItemId').textContent = itemId;
                        document.getElementById('qrItemDetails').textContent = 'New Item';
                        
                        // Generate QR code
                        const canvas = SimpleQRCode.generate(itemId, 200);
                        qrContainer.appendChild(canvas);
                        
                        // Show modal
                        AppState.showModal('qrCodeModal');
                        
                        // Setup download button
                        document.getElementById('downloadQrCodeBtn').onclick = () => {
                            SimpleQRCode.download(canvas, `qr-code-${itemId}.png`);
                        };
                        
                        // Setup print button
                        document.getElementById('printQrCodeBtn').onclick = () => {
                            const printWindow = window.open('', '_blank');
                            printWindow.document.write(`
                                <html>
                                    <head>
                                        <title>QR Code - ${itemId}</title>
                                        <style>
                                            body { font-family: Arial, sans-serif; margin: 20px; text-align: center; }
                                            .label { margin: 20px; display: inline-block; }
                                            .item-id { font-size: 18px; font-weight: bold; margin: 10px 0; }
                                            @media print {
                                                body { margin: 0; }
                                                .no-print { display: none; }
                                            }
                                        </style>
                                    </head>
                                    <body>
                                        <button class="no-print" onclick="window.print()" style="padding: 10px 20px; background: #1e88e5; color: white; border: none; border-radius: 5px; cursor: pointer; margin-bottom: 20px;">Print Labels</button>
                                        <div class="label">
                                            <canvas id="qrCanvas"></canvas>
                                            <div class="item-id">${itemId}</div>
                                        </div>
                                        <script>
                                            const canvas = document.getElementById('qrCanvas');
                                            const ctx = canvas.getContext('2d');
                                            const img = new Image();
                                            img.onload = function() {
                                                canvas.width = 200;
                                                canvas.height = 200;
                                                ctx.drawImage(img, 0, 0, 200, 200);
                                            };
                                            img.src = '${canvas.toDataURL()}';
                                        <\/script>
                                    </body>
                                </html>
                            `);
                            printWindow.document.close();
                        };
                    };
                    AppState.showQRCode();
                } else {
                    alert('Please enter an item ID first');
                }
            });
            
            // Add category button
            document.getElementById('addCategoryBtn').addEventListener('click', () => {
                const categorySelect = document.getElementById('itemCategorySelect');
                const category = categorySelect.value;
                
                if (category) {
                    const selectedCategories = document.getElementById('selectedCategories');
                    
                    // Check if category already added
                    const existing = Array.from(selectedCategories.querySelectorAll('span')).some(span => 
                        span.textContent.replace('', '').trim() === category
                    );
                    
                    if (!existing) {
                        const span = document.createElement('span');
                        span.className = 'px-2 py-1 bg-gray-100 text-gray-700 text-sm rounded mr-2 mb-1 inline-flex items-center';
                        span.innerHTML = `${category} <button type="button" class="ml-1 text-gray-500 remove-category"><i class="fas fa-times"></i></button>`;
                        selectedCategories.appendChild(span);
                        
                        // Add event listener to remove button
                        span.querySelector('.remove-category').addEventListener('click', () => {
                            span.remove();
                        });
                    }
                    
                    // Reset select
                    categorySelect.value = '';
                }
            });
            
            // Item image button
            document.getElementById('itemImageBtn').addEventListener('click', () => {
                document.getElementById('itemImage').click();
            });
            
            // Item image preview
            document.getElementById('itemImage').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                // Check file size (max 2MB)
                if (file.size > 2 * 1024 * 1024) {
                    alert('Image size must be less than 2MB');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    const imagePreview = document.getElementById('itemImagePreview');
                    imagePreview.innerHTML = `<img src="${event.target.result}" alt="Item image" class="w-full h-full object-cover rounded-lg">`;
                    document.getElementById('itemImageRemoveBtn').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            });
            
            // Remove image button
            document.getElementById('itemImageRemoveBtn').addEventListener('click', () => {
                document.getElementById('itemImagePreview').innerHTML = '<i class="fas fa-camera text-gray-400 text-4xl"></i>';
                document.getElementById('itemImageRemoveBtn').classList.add('hidden');
                document.getElementById('itemImage').value = '';
            });
            
            // Close item modal buttons
            document.getElementById('closeItemModal').addEventListener('click', () => {
                AppState.hideModal('itemModal');
            });
            
            document.getElementById('cancelItemBtn').addEventListener('click', () => {
                AppState.hideModal('itemModal');
            });
            
            // Close QR code modal
            document.getElementById('closeQrCodeModal').addEventListener('click', () => {
                AppState.hideModal('qrCodeModal');
            });
            
            // Add venue button
            document.getElementById('addVenueBtn').addEventListener('click', () => {
                // Reset form for new venue
                document.getElementById('venueForm').reset();
                document.getElementById('venueModalTitle').textContent = 'Add Venue';
                document.getElementById('venueId').value = '';
                AppState.showModal('venueModal');
            });
            
            // Venue form
            document.getElementById('venueForm').addEventListener('submit', (e) => {
                e.preventDefault();
                AppState.saveVenue();
            });
            
            // Submit venue button (explicit)
            document.getElementById('submitVenueBtn').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('venueForm').dispatchEvent(new Event('submit'));
            });
            
            // Close venue modal buttons
            document.getElementById('closeVenueModal').addEventListener('click', () => {
                AppState.hideModal('venueModal');
            });
            
            document.getElementById('cancelVenueBtn').addEventListener('click', () => {
                AppState.hideModal('venueModal');
            });
            
            // Inventory search and filters
            document.getElementById('searchInventory').addEventListener('input', (e) => {
                const searchTerm = e.target.value;
                const filterStatus = document.getElementById('filterStatus').value;
                const filterVenue = document.getElementById('filterVenue').value;
                AppState.updateInventoryList(filterStatus, filterVenue, searchTerm);
            });
            
            document.getElementById('filterStatus').addEventListener('change', (e) => {
                const filterStatus = e.target.value;
                const filterVenue = document.getElementById('filterVenue').value;
                const searchTerm = document.getElementById('searchInventory').value;
                AppState.updateInventoryList(filterStatus, filterVenue, searchTerm);
            });
            
            document.getElementById('filterVenue').addEventListener('change', (e) => {
                const filterVenue = e.target.value;
                const filterStatus = document.getElementById('filterStatus').value;
                const searchTerm = document.getElementById('searchInventory').value;
                AppState.updateInventoryList(filterStatus, filterVenue, searchTerm);
            });
            
            // Tech check buttons
            document.getElementById('auditBack').addEventListener('click', () => {
                document.getElementById('auditStep2').classList.add('hidden');
                document.getElementById('auditStep1').classList.remove('hidden');
                document.getElementById('auditCompleteStep').classList.add('hidden');
            });
            
            document.getElementById('auditComplete').addEventListener('click', () => {
                AppState.completeAudit();
            });
            
            document.getElementById('auditNew').addEventListener('click', () => {
                document.getElementById('auditCompleteStep').classList.add('hidden');
                document.getElementById('auditStep1').classList.remove('hidden');
                document.getElementById('auditStep2').classList.add('hidden');
            });
            
            document.getElementById('auditViewReport').addEventListener('click', () => {
                AppState.generateAuditReport();
            });
            
            // Report modal
            document.getElementById('closeReportModal').addEventListener('click', () => {
                AppState.hideModal('reportModal');
            });
            
            document.getElementById('printReportBtn').addEventListener('click', () => {
                window.print();
            });
            
            // Settings page event listeners
            document.getElementById('darkModeToggle').addEventListener('change', (e) => {
                AppState.darkModeManager.toggleDarkMode();
            });
            
            document.getElementById('systemThemeToggle').addEventListener('change', (e) => {
                AppState.darkModeManager.toggleSystemTheme();
            });
            
            document.getElementById('menuDarkModeToggle').addEventListener('change', (e) => {
                AppState.darkModeManager.toggleDarkMode();
            });
            
            // Settings toggles
            document.getElementById('autoSaveToggle').addEventListener('change', (e) => {
                AppState.settings.autoSave = e.target.checked;
                AppState.save();
            });
            
            document.getElementById('auditRemindersToggle').addEventListener('change', (e) => {
                AppState.settings.auditReminders = e.target.checked;
                AppState.save();
            });
            
            document.getElementById('stockAlertsToggle').addEventListener('change', (e) => {
                AppState.settings.stockAlerts = e.target.checked;
                AppState.save();
            });
            
            // Data management buttons
            document.getElementById('exportDataBtn').addEventListener('click', () => {
                AppState.exportJournal();
            });
            
            document.getElementById('importDataBtn').addEventListener('click', () => {
                document.getElementById('dataImportInput').click();
            });
            
            document.getElementById('clearDataBtn').addEventListener('click', () => {
                AppState.clearAllData();
            });
            
            // Data import input
            document.getElementById('dataImportInput').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    AppState.importAllData(event.target.result);
                };
                reader.readAsText(file);
                
                // Reset file input
                e.target.value = '';
            });
            
            // About button
            document.getElementById('aboutInventorBtn').addEventListener('click', () => {
                alert('Inventor v1.0\n\nA Progressive Web App for inventory management and tech checks.\n\nFeatures:\n- Inventory tracking\n- Venue management\n- Equipment audits\n- QR code generation\n- Dark mode\n- Offline support\n\nBuilt with Tailwind CSS and vanilla JavaScript.');
            });
            
            // Account page event listeners
            document.getElementById('editProfileBtn').addEventListener('click', () => {
                AppState.editProfile();
            });
            
            document.getElementById('editCompanyNameBtn').addEventListener('click', () => {
                AppState.editCompanyName();
            });
            
            document.getElementById('changePasswordBtn').addEventListener('click', () => {
                alert('Password change functionality would be implemented in a full application with backend authentication.');
            });
            
            document.getElementById('backupDataBtn').addEventListener('click', () => {
                AppState.exportAllData();
            });
            
            document.getElementById('exportAllDataBtn').addEventListener('click', () => {
                AppState.exportAllData();
            });
            
            document.getElementById('logoutBtn').addEventListener('click', () => {
                if (confirm('Are you sure you want to log out?')) {
                    alert('Logout functionality would be implemented in a full application with backend authentication.\n\nFor now, this would clear your session data.');
                    // In a real app, this would clear session tokens, etc.
                }
            });
            
            // Profile modal
            document.getElementById('closeProfileModal').addEventListener('click', () => {
                AppState.hideModal('profileModal');
            });
            
            document.getElementById('cancelProfileBtn').addEventListener('click', () => {
                AppState.hideModal('profileModal');
            });
            
            document.getElementById('profileForm').addEventListener('submit', (e) => {
                e.preventDefault();
                AppState.saveProfile();
            });
            
            document.getElementById('submitProfileBtn').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('profileForm').dispatchEvent(new Event('submit'));
            });
            
            // Company name modal
            document.getElementById('closeCompanyNameModal').addEventListener('click', () => {
                AppState.hideModal('companyNameModal');
            });
            
            document.getElementById('cancelCompanyNameBtn').addEventListener('click', () => {
                AppState.hideModal('companyNameModal');
            });
            
            document.getElementById('companyNameForm').addEventListener('submit', (e) => {
                e.preventDefault();
                AppState.saveCompanyName();
            });
            
            document.getElementById('submitCompanyNameBtn').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('companyNameForm').dispatchEvent(new Event('submit'));
            });
            
            // Modal backdrop click
            document.getElementById('modalBackdrop').addEventListener('click', () => {
                AppState.hideModal();
            });
            
            // Register service worker for PWA functionality
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    const serviceWorkerCode = `
                        self.addEventListener('install', event => {
                            console.log('Service Worker installing.');
                        });
                        
                        self.addEventListener('activate', event => {
                            console.log('Service Worker activating.');
                        });
                        
                        self.addEventListener('fetch', event => {
                            event.respondWith(
                                caches.match(event.request)
                                .then(response => {
                                    return response || fetch(event.request);
                                })
                            );
                        });
                    `;
                    
                    const blob = new Blob([serviceWorkerCode], { type: 'application/javascript' });
                    const swURL = URL.createObjectURL(blob);
                    
                    navigator.serviceWorker.register(swURL)
                        .then(registration => {
                            console.log('ServiceWorker registered with scope:', registration.scope);
                        })
                        .catch(error => {
                            console.log('ServiceWorker registration failed:', error);
                        });
                });
            }
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Ctrl/Cmd + S to save (export)
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    AppState.exportJournal();
                }
                
                // Ctrl/Cmd + O to load journal
                if ((e.ctrlKey || e.metaKey) && e.key === 'o') {
                    e.preventDefault();
                    document.getElementById('journalFileInput').click();
                }
                
                // Escape to close modals
                if (e.key === 'Escape') {
                    AppState.hideModal();
                    AppState.hideMenu();
                }
                
                // Ctrl/Cmd + D to toggle dark mode
                if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
                    e.preventDefault();
                    AppState.darkModeManager.toggleDarkMode();
                }
            });
            
            // Prevent drag-and-drop file open behavior
            document.addEventListener('dragover', (e) => {
                e.preventDefault();
            });
            
            document.addEventListener('drop', (e) => {
                e.preventDefault();
            });
        });
    </script>
</body>
</html>
